<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <title>Sistema de Emissão e Gestão de RID's</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDAcuwo5FZBs5013klfSMfWkQZbFjqYpbw",
      authDomain: "novo-rid-dezembro.firebaseapp.com",
      projectId: "novo-rid-dezembro",
      storageBucket: "novo-rid-dezembro.firebasestorage.app",
      messagingSenderId: "629184938088",
      appId: "1:629184938088:web:3821e7ea07897ae655fbdd"
    };

    const app = initializeApp(firebaseConfig);
    window.firebaseAuth = getAuth(app);
    window.firebaseDb = getFirestore(app);
    window.firebaseModules = {
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      onAuthStateChanged,
      signOut,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      deleteDoc,
      doc,
      query,
      where,
      orderBy,
      onSnapshot,
      serverTimestamp
    };
    window.firebaseReady = true;
    window.dispatchEvent(new Event('firebaseReady'));
  </script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    html {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    * {
      scrollbar-width: thin;
      scrollbar-color: #b0b0b0 #ece5df;
    }
    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    *::-webkit-scrollbar-track {
      background: #ece5df;
      border-radius: 4px;
    }
    *::-webkit-scrollbar-thumb {
      background: #b0b0b0;
      border-radius: 4px;
    }
    *::-webkit-scrollbar-thumb:hover {
      background: #8a8a8a;
    }
    :focus-visible {
      outline: 2px solid #ffd57a;
      outline-offset: 2px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="w-full h-full bg-[#ece5df]">
  <main id="app-root" class="w-full h-full flex flex-col bg-[#ece5df] text-[#2c2c2c] font-sans">
   <section id="view-container" class="w-full flex-1 flex items-stretch justify-center overflow-hidden"><!-- LOGIN VIEW -->
    <div id="view-login" class="w-full h-full flex items-center justify-center px-4 py-6 overflow-auto">
     <div class="w-full max-w-md">
      <div class="rounded-2xl bg-white border border-[#b0b0b0] shadow-xl px-6 py-8 space-y-6">
       <div class="text-center space-y-4">
        <div class="w-32 h-32 mx-auto p-2"><img src="https://th.bing.com/th/id/R.65cf039c1a761f9ab3e86014c8428574?rik=rHlKpfKgwYkrrQ&pid=ImgRaw&r=0" alt="Logo J. DEMITO" class="w-full h-full object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center\'><span class=\'text-4xl font-bold text-[#2c2c2c]\'>JD</span></div>';">
        </div>
        <div class="space-y-2">
         <h1 class="text-2xl font-bold text-[#2c2c2c]">Sistema de Gestão e Emissão de RID's</h1>
         <p class="text-sm text-[#5a5a5a]">Faça login com seu CPF</p>
        </div>
       </div>
       <form id="login-form" class="space-y-4">
        <div class="space-y-1.5"><label for="cpf-login" class="block text-sm font-medium text-[#2c2c2c]"> CPF </label> <input id="cpf-login" type="text" maxlength="14" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm text-[#2c2c2c] placeholder-[#5a5a5a] focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 transition-colors" placeholder="000.000.000-00" required>
        </div>
        <div class="space-y-1.5"><label for="senha-login" class="block text-sm font-medium text-[#2c2c2c]"> Senha </label> <input id="senha-login" type="password" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm text-[#2c2c2c] placeholder-[#5a5a5a] focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 transition-colors" placeholder="Digite sua senha" required>
        </div>
        <div id="login-message" class="text-xs min-h-[1.25rem] text-center"></div>
        <div class="space-y-3 pt-1"><button id="btn-entrar" type="submit" class="w-full px-6 py-3 rounded-xl text-sm font-semibold text-[#2c2c2c] bg-[#ffd57a] hover:bg-[#ffeab8] transition-colors shadow-md disabled:opacity-70 disabled:cursor-not-allowed"> Entrar </button> <button id="btn-cadastrar" type="button" class="w-full px-6 py-3 rounded-xl text-sm font-semibold text-[#2c2c2c] border border-[#b0b0b0] bg-transparent hover:bg-[#d6d6d4] transition-colors"> Criar Nova Conta </button>
        </div>
       </form>
      </div>
     </div>
    </div><!-- ADMIN VIEW -->
    <div id="view-admin" class="hidden w-full h-full">
     <div class="w-full h-full flex flex-col">
      <header class="flex-shrink-0 bg-[#e8e7e6] border-b border-[#b0b0b0]">
       <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
         <div class="w-16 h-16"><img src="https://tse2.mm.bing.net/th/id/OIP.Zc8DnBp2H5qz6GAUyEKFdAHaFP?rs=1&amp;pid=ImgDetMain" alt="Logo" class="w-full h-full object-contain" onerror="this.style.display='none';">
         </div>
         <div>
          <h1 class="text-lg font-bold text-[#2c2c2c]">Painel Administrativo</h1>
          <p class="text-xs text-[#5a5a5a]">Gestão de RID's</p>
         </div>
        </div>
        <div class="flex items-center gap-2">
         <div class="relative"><button id="btn-notificacoes-admin" class="w-10 h-10 flex items-center justify-center hover:bg-[#d6d6d4] rounded-lg transition-colors relative">
           <svg class="w-6 h-6 text-[#2c2c2c]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
           </svg><span id="badge-notif-admin" class="hidden absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-[#e8e7e6]"></span> </button>
          <div id="dropdown-notificacoes-admin" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl min-w-[320px] max-w-[400px] overflow-hidden z-50">
           <div class="px-4 py-3 border-b border-[#b0b0b0] bg-[#e8e7e6]">
            <h4 class="text-sm font-semibold text-[#2c2c2c]">Notificações</h4>
           </div>
           <div id="lista-notificacoes-admin" class="max-h-[400px] overflow-y-auto">
            <div class="px-4 py-8 text-center text-sm text-[#5a5a5a]">
             Nenhuma notificação
            </div>
           </div>
          </div>
         </div>
         <div class="relative"><button id="btn-menu-admin" class="w-10 h-10 flex flex-col items-center justify-center gap-1.5 hover:bg-[#d6d6d4] rounded-lg transition-colors"> <span class="w-6 h-0.5 bg-[#2c2c2c] rounded-full"></span> <span class="w-6 h-0.5 bg-[#2c2c2c] rounded-full"></span> <span class="w-6 h-0.5 bg-[#2c2c2c] rounded-full"></span> </button>
          <div id="dropdown-menu-admin" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl min-w-[160px] overflow-hidden z-50"><button id="btn-logout-admin" class="w-full px-4 py-3 text-left text-sm font-semibold text-red-600 hover:bg-red-50 transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
            </svg> Sair </button>
          </div>
         </div>
        </div>
       </div>
       <nav class="border-t border-[#b0b0b0] bg-[#e8e7e6]">
        <div class="max-w-6xl mx-auto px-4">
         <ul class="flex items-center gap-2 text-sm py-2">
          <li><button id="btn-nav-dashboard" type="button" class="px-4 py-2 rounded-full bg-[#ffd57a] text-[#2c2c2c] font-semibold"> Dashboard </button></li>
          <li><button id="btn-nav-rids" type="button" class="px-4 py-2 rounded-full text-[#2c2c2c] hover:bg-[#ece5df] transition-colors"> RIDs </button></li>
          <li><button id="btn-nav-funcionarios" type="button" class="px-4 py-2 rounded-full text-[#2c2c2c] hover:bg-[#ece5df] transition-colors"> Funcionários </button></li>
          <li><button id="btn-nav-solicitacoes" type="button" class="px-4 py-2 rounded-full text-[#2c2c2c] hover:bg-[#ece5df] transition-colors"> Solicitações </button></li>
          <li><button id="btn-nav-relatorios" type="button" class="px-4 py-2 rounded-full text-[#2c2c2c] hover:bg-[#ece5df] transition-colors"> Relatórios </button></li>
         </ul>
        </div>
       </nav>
      </header>
      <div class="flex-1 overflow-auto"><!-- Dashboard Section -->
       <div id="admin-section-dashboard" class="p-6">
        <div class="max-w-6xl mx-auto space-y-6">
         <div class="flex items-center justify-between">
          <h2 class="text-2xl font-bold text-[#2c2c2c]">Visão Geral</h2>
          <div class="relative"><button id="btn-filtro-visao" class="w-10 h-10 flex items-center justify-center rounded-lg border border-[#b0b0b0] hover:bg-[#ece5df] transition-colors">
            <svg class="w-5 h-5 text-[#2c2c2c]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
            </svg></button>
           <div id="dropdown-filtro-visao" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl p-4 z-50 min-w-[280px]">
            <div class="space-y-3">
             <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Mês</label> <select id="filtro-mes-visao" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40"> <option value="">Todos os meses</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Mar     o</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
             </div>
             <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Ano</label> <input id="filtro-ano-visao" type="number" placeholder="Ano (ex: 2024)" min="2000" max="2100" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40">
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="grid grid-cols-4 gap-3">
          <div class="bg-white rounded-xl border border-[#b0b0b0] p-6 shadow-sm">
           <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
             <svg class="w-10 h-10 text-[#ffd57a]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
             </svg>
             <p class="text-sm font-medium text-[#5a5a5a]">Total de RIDs</p>
            </div>
            <p id="total-rids" class="text-3xl font-bold text-[#2c2c2c]">0</p>
           </div>
          </div>
          <div class="bg-white rounded-xl border border-[#b0b0b0] p-6 shadow-sm">
           <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
             <svg class="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
             </svg>
             <p class="text-sm font-medium text-[#5a5a5a]">Em Andamento</p>
            </div>
            <p id="rids-andamento" class="text-3xl font-bold text-[#2c2c2c]">0</p>
           </div>
          </div>
          <div class="bg-white rounded-xl border border-[#b0b0b0] p-6 shadow-sm">
           <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
             <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
             </svg>
             <p class="text-sm font-medium text-[#5a5a5a]">Vencidos</p>
            </div>
            <p id="rids-vencidos" class="text-3xl font-bold text-[#2c2c2c]">0</p>
           </div>
          </div>
          <div class="bg-white rounded-xl border border-[#b0b0b0] p-6 shadow-sm">
           <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
             <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
             </svg>
             <p class="text-sm font-medium text-[#5a5a5a]">Corrigidos</p>
            </div>
            <p id="rids-corrigidos" class="text-3xl font-bold text-[#2c2c2c]">0</p>
           </div>
          </div>
         </div>
         <div class="space-y-3">
          <h2 class="text-2xl font-bold text-[#2c2c2c]">RIDs Recentes</h2>
          <div class="bg-white rounded-xl border border-[#b0b0b0] shadow-sm overflow-hidden">
           <div id="rids-recentes-container" class="overflow-y-auto" style="max-height: 360px;">
            <div class="text-center py-8 text-[#5a5a5a]">
             Carregando RIDs recentes...
            </div>
           </div>
          </div>
         </div>
         <div class="space-y-3">
          <div class="flex items-center justify-between">
           <h2 class="text-2xl font-bold text-[#2c2c2c]">Ranking de Emissões</h2>
           <div class="relative"><button id="btn-filtro-ranking" class="w-10 h-10 flex items-center justify-center rounded-lg border border-[#b0b0b0] hover:bg-[#ece5df] transition-colors">
             <svg class="w-5 h-5 text-[#2c2c2c]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
             </svg></button>
            <div id="dropdown-filtro-ranking" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl p-4 z-50 min-w-[280px]">
             <div class="space-y-3">
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Mês</label> <select id="filtro-mes-ranking" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40"> <option value="">Todos os meses</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Março</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
              </div>
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Ano</label> <input id="filtro-ano-ranking" type="number" placeholder="Ano (ex: 2024)" min="2000" max="2100" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40">
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="bg-white rounded-xl border border-[#b0b0b0] shadow-sm overflow-hidden p-6">
           <div id="ranking-emissoes-container">
            <div class="text-center py-8 text-[#5a5a5a]">
             Carregando ranking...
            </div>
           </div>
          </div>
         </div>
        </div>
       </div><!-- RIDs Section -->
       <div id="admin-section-rids" class="hidden p-6">
        <div class="max-w-6xl mx-auto space-y-6">
         <div class="flex items-center justify-between">
          <div>
           <h2 class="text-2xl font-bold mb-2">Gerenciar RIDs</h2>
           <p class="text-[#5a5a5a]">Lista de todos os RIDs cadastrados</p>
          </div>
          <div class="flex items-center gap-3">
           <div class="relative"><button id="btn-filtro-rids" class="w-10 h-10 flex items-center justify-center rounded-lg border border-[#b0b0b0] hover:bg-[#ece5df] transition-colors">
             <svg class="w-5 h-5 text-[#2c2c2c]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
             </svg></button>
            <div id="dropdown-filtro-rids" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl p-4 z-50 min-w-[320px]">
             <div class="space-y-3">
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Pesquisar por ID ou Emitente</label> <input id="filtro-pesquisa-rids" type="text" placeholder="Digite o número do RID ou nome do emitente" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40">
              </div>
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Mês</label> <select id="filtro-mes-rids" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40"> <option value="">Todos os meses</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Março</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
              </div>
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Ano</label> <input id="filtro-ano-rids" type="number" placeholder="Ano (ex: 2024)" min="2000" max="2100" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40">
              </div>
              <div class="flex gap-2 pt-2"><button id="btn-limpar-filtros-rids" type="button" class="flex-1 px-3 py-2 rounded-lg border border-[#b0b0b0] hover:bg-[#ece5df] text-xs font-semibold transition-colors"> Limpar </button> <button id="btn-aplicar-filtros-rids" type="button" class="flex-1 px-3 py-2 rounded-lg bg-[#ffd57a] hover:bg-[#ffeab8] text-xs font-semibold transition-colors"> Aplicar </button>
              </div>
             </div>
            </div>
           </div><button id="btn-criar-rid" class="px-4 py-2 rounded-lg bg-[#ffd57a] hover:bg-[#ffeab8] text-[#2c2c2c] text-sm font-semibold shadow-md transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg> Criar Novo RID </button>
          </div>
         </div>
         <div class="bg-white rounded-xl border border-[#b0b0b0] overflow-hidden">
          <div class="overflow-x-auto">
           <table class="w-full">
            <thead class="bg-[#e8e7e6] border-b border-[#b0b0b0]">
             <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Número</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Emitente</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Setor</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Data</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Status</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-[#2c2c2c]">Ação</th>
             </tr>
            </thead>
            <tbody id="rids-table-body" class="divide-y divide-[#b0b0b0]">
             <tr>
              <td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando RIDs...</td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
       </div><!-- Funcionários Section -->
       <div id="admin-section-funcionarios" class="hidden p-6">
        <div class="max-w-6xl mx-auto space-y-6">
         <div class="flex items-center justify-between">
          <div>
           <h2 class="text-2xl font-bold mb-2">Gerenciar Funcionários</h2>
           <p class="text-[#5a5a5a]">Lista de todos os funcionários cadastrados</p>
          </div>
          <div class="flex items-center gap-3"><button id="btn-cadastrar-funcionario" class="px-4 py-2 rounded-lg bg-[#ffd57a] hover:bg-[#ffeab8] text-[#2c2c2c] text-sm font-semibold shadow-md transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg> Cadastrar Funcionário </button>
          </div>
         </div>
         <div class="bg-white rounded-xl border border-[#b0b0b0] overflow-hidden">
          <div class="overflow-x-auto">
           <table class="w-full">
            <thead class="bg-[#e8e7e6] border-b border-[#b0b0b0]">
             <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Nome</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">CPF</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Setor</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Tipo</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-[#2c2c2c]">Ações</th>
             </tr>
            </thead>
            <tbody id="funcionarios-table-body" class="divide-y divide-[#b0b0b0]">
             <tr>
              <td colspan="5" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando funcionários...</td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
       </div><!-- Solicitações Section -->
       <div id="admin-section-solicitacoes" class="hidden p-6">
        <div class="max-w-6xl mx-auto space-y-6">
         <div class="flex items-center justify-between">
          <div>
           <h2 class="text-2xl font-bold mb-2">Solicitações de Exclusão</h2>
           <p class="text-[#5a5a5a]">Gerencie as solicitações de exclusão de RIDs</p>
          </div>
         </div>
         <div class="bg-white rounded-xl border border-[#b0b0b0] overflow-hidden">
          <div class="overflow-x-auto">
           <table class="w-full">
            <thead class="bg-[#e8e7e6] border-b border-[#b0b0b0]">
             <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">RID</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Solicitante</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Motivo</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Data</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Status</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-[#2c2c2c]">Ações</th>
             </tr>
            </thead>
            <tbody id="solicitacoes-table-body" class="divide-y divide-[#b0b0b0]">
             <tr>
              <td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando solicitações...</td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
       </div><!-- Relatórios Section -->
       <div id="admin-section-relatorios" class="hidden p-6">
        <div class="max-w-7xl mx-auto space-y-6">
         <div class="flex items-center justify-between">
          <div>
           <h2 class="text-2xl font-bold mb-2">Relatórios Detalhados</h2>
           <p class="text-[#5a5a5a]">Visualize todos os detalhes dos RIDs cadastrados</p>
          </div>
          <div class="flex items-center gap-3">
           <div class="relative"><button id="btn-filtro-relatorios" class="w-10 h-10 flex items-center justify-center rounded-lg border border-[#b0b0b0] hover:bg-[#ece5df] transition-colors">
             <svg class="w-5 h-5 text-[#2c2c2c]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
             </svg></button>
            <div id="dropdown-filtro-relatorios" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl p-4 z-50 min-w-[280px]">
             <div class="space-y-3">
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Mês</label> <select id="filtro-mes-relatorios" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40"> <option value="">Todos os meses</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Março</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
              </div>
              <div><label class="block text-xs font-medium text-[#2c2c2c] mb-1.5">Ano</label> <input id="filtro-ano-relatorios" type="number" placeholder="Ano (ex: 2024)" min="2000" max="2100" class="w-full px-3 py-2 rounded-lg border border-[#b0b0b0] bg-white text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40">
              </div>
             </div>
            </div>
           </div><button id="btn-exportar-relatorio" class="px-4 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white text-sm font-semibold shadow-md transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg> Exportar CSV </button>
          </div>
         </div>
         <div class="bg-white rounded-xl border border-[#b0b0b0] overflow-hidden">
          <div class="overflow-x-auto" style="max-height: 600px;">
           <table class="w-full">
            <thead class="bg-[#e8e7e6] border-b border-[#b0b0b0] sticky top-0">
             <tr>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Unidade</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">RID N   </th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Data Emissão</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Emitente</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Funcionário/Terceiro/Visitante</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Setor/Empresa</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Local do Incidente</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Gênese do Incidente</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Origem da Detecção</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Descrição</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Classificação de Risco</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Ação Imediata</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Ações Corretivas</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Responsável pelas Ações</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Prazo para Conclusão</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Data de Conclusão</th>
              <th class="px-3 py-3 text-left text-xs font-semibold text-[#2c2c2c] whitespace-nowrap">Status</th>
             </tr>
            </thead>
            <tbody id="relatorios-table-body" class="divide-y divide-[#b0b0b0]">
             <tr>
              <td colspan="17" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando relatórios...</td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div><!-- FUNCION    RIO VIEW -->
    <div id="view-func" class="hidden w-full h-full">
     <div class="w-full h-full flex flex-col">
      <header class="flex-shrink-0 bg-[#e8e7e6] border-b border-[#b0b0b0]">
       <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
         <div class="w-16 h-16"><img src="https://tse2.mm.bing.net/th/id/OIP.Zc8DnBp2H5qz6GAUyEKFdAHaFP?rs=1&amp;pid=ImgDetMain" alt="Logo" class="w-full h-full object-contain" onerror="this.style.display='none';">
         </div>
         <div>
          <h1 class="text-lg font-bold text-[#2c2c2c]">Painel do Funcionário</h1>
          <p class="text-xs text-[#5a5a5a]">Sistema de RID's</p>
         </div>
        </div>
        <div class="flex items-center gap-2">
         <div class="relative"><button id="btn-notificacoes-func" class="w-10 h-10 flex items-center justify-center hover:bg-[#d6d6d4] rounded-lg transition-colors relative">
           <svg class="w-6 h-6 text-[#2c2c2c]" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
           </svg><span id="badge-notif-func" class="hidden absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-[#e8e7e6]"></span> </button>
          <div id="dropdown-notificacoes-func" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl min-w-[320px] max-w-[400px] overflow-hidden z-50">
           <div class="px-4 py-3 border-b border-[#b0b0b0] bg-[#e8e7e6]">
            <h4 class="text-sm font-semibold text-[#2c2c2c]">Notificações</h4>
           </div>
           <div id="lista-notificacoes-func" class="max-h-[400px] overflow-y-auto">
            <div class="px-4 py-8 text-center text-sm text-[#5a5a5a]">
             Nenhuma notificação
            </div>
           </div>
          </div>
         </div>
         <div class="relative"><button id="btn-menu-func" class="w-10 h-10 flex flex-col items-center justify-center gap-1.5 hover:bg-[#d6d6d4] rounded-lg transition-colors"> <span class="w-6 h-0.5 bg-[#2c2c2c] rounded-full"></span> <span class="w-6 h-0.5 bg-[#2c2c2c] rounded-full"></span> <span class="w-6 h-0.5 bg-[#2c2c2c] rounded-full"></span> </button>
          <div id="dropdown-menu-func" class="hidden absolute right-0 top-12 bg-white border border-[#b0b0b0] rounded-xl shadow-xl min-w-[160px] overflow-hidden z-50"><button id="btn-logout-func" class="w-full px-4 py-3 text-left text-sm font-semibold text-red-600 hover:bg-red-50 transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
            </svg> Sair </button>
          </div>
         </div>
        </div>
       </div>
      </header>
      <div class="flex-1 overflow-auto p-6">
       <div class="max-w-6xl mx-auto space-y-6">
        <div class="flex items-center justify-between">
         <div>
          <h2 class="text-2xl font-bold mb-2">Meus RIDs</h2>
          <p class="text-[#5a5a5a]">Gerencie seus relatórios de incidentes e desvios</p>
         </div><button id="btn-criar-rid-func" class="px-4 py-2 rounded-lg bg-[#ffd57a] hover:bg-[#ffeab8] text-[#2c2c2c] text-sm font-semibold shadow-md transition-colors flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg> Criar Novo RID </button>
        </div>
        <div class="bg-white rounded-xl border border-[#b0b0b0] overflow-hidden">
         <div class="overflow-x-auto">
          <table class="w-full">
           <thead class="bg-[#e8e7e6] border-b border-[#b0b0b0]">
            <tr>
             <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Número</th>
             <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Unidade</th>
             <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Data</th>
             <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Local</th>
             <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Status</th>
             <th class="px-4 py-3 text-center text-xs font-semibold text-[#2c2c2c]">Ações</th>
            </tr>
           </thead>
           <tbody id="func-rids-table-body" class="divide-y divide-[#b0b0b0]">
            <tr>
             <td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando seus RIDs...</td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </section><!-- Modal Criar RID -->
   <div id="modal-criar-rid" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl border border-[#b0b0b0] max-w-3xl w-full max-h-[90%] overflow-auto">
     <div class="px-6 py-4 border-b border-[#b0b0b0] flex items-center justify-between sticky top-0 bg-white z-10">
      <h3 class="text-lg font-semibold text-[#2c2c2c]">Criar Novo RID</h3><button id="btn-fechar-modal-rid" class="w-8 h-8 rounded-full hover:bg-[#ece5df] flex items-center justify-center text-2xl">  </button>
     </div>
     <form id="form-criar-rid" class="px-6 py-6 space-y-5">
      <div><label for="rid-emitente" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">1. Emitente</label> <input id="rid-emitente" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#d6d6d4] text-sm cursor-not-allowed opacity-75" placeholder="Carregando..." readonly required>
      </div>
      <div><label for="rid-tipo-contrato" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">2. Tipo de contrato</label> <select id="rid-tipo-contrato" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Funcionário">Funcionário</option> <option value="Terceiro Contratado">Terceiro Contratado</option> <option value="Terceiro Eventual">Terceiro Eventual</option> <option value="Visitante">Visitante</option> </select>
      </div>
      <div><label for="rid-unidade" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">3. Unidade</label> <input id="rid-unidade" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 uppercase" placeholder="Insira a unidade" required>
      </div>
      <div><label for="rid-setor" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">4. Setor do emitente</label> <select id="rid-setor" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="ADM">ADM</option> <option value="M. MOVEL">M. MOVEL</option> <option value="M. FIXA">M. FIXA</option> <option value="M. ELÉTRICA">M. ELÉTRICA</option> <option value="PRODUÇÃO">PRODUÇÃO</option> <option value="MINA">MINA</option> </select>
      </div>
      <div><label for="rid-data" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">5. Data</label> <input id="rid-data" type="date" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required>
      </div>
      <div><label for="rid-incidente" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">6. Incidente ou Desvios</label> <select id="rid-incidente" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Condição de Risco">Condição de Risco</option> <option value="Desvio Comportamental">Desvio Comportamental</option> <option value="Dano Material">Dano Material</option> <option value="Quase acidente">Quase acidente</option> </select>
      </div>
      <div><label for="rid-origem" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">7. Origem da detecção</label> <select id="rid-origem" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="CSL">CSL</option> <option value="Inspeção programada">Inspeção programada</option> <option value="Inspeção não programada">Inspeção não programada</option> <option value="Observação Comportamental">Observação Comportamental</option> <option value="Constatação espontânea">Constatação espontânea</option> <option value="Auditoria">Auditoria</option> </select>
      </div>
      <div><label for="rid-local" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">8. Local da ocorrência</label> <input id="rid-local" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" placeholder="Insira o local da ocorrência" required>
      </div>
      <div><label for="rid-descricao" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">9. Descrição da Ocorrência</label> <textarea id="rid-descricao" rows="4" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 resize-none" placeholder="Descreva detalhadamente a ocorrência" required></textarea>
      </div>
      <div><label for="rid-acao-imediata" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">10. Ação Imediata</label> <textarea id="rid-acao-imediata" rows="3" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 resize-none" placeholder="Descreva a ação imediata tomada" required></textarea>
      </div>
      <div><label for="rid-classificacao" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">11. Classificação de risco</label> <select id="rid-classificacao" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Baixo">Baixo - Risco mínimo, sem impacto significativo</option> <option value="Médio">Médio - Risco moderado, requer atenção</option> <option value="Alto">Alto - Risco elevado, ação urgente necessária</option> <option value="Crítico">Crítico - Risco extremo, ação imediata obrigatória</option> </select>
      </div>
      <div><label for="rid-status" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">12. Status</label> <select id="rid-status" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Em Andamento">EM ANDAMENTO - O problema está sendo tratado</option> <option value="Corrigido">CORRIGIDO - O problema foi resolvido completamente</option> <option value="Vencido">VENCIDO - O prazo de correção foi ultrapassado</option> </select>
      </div>
      <div><label for="rid-lider" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">13. Designar para um líder (Opcional)</label> <select id="rid-lider" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40"> <option value="">Carregando administradores...</option> </select>
      </div>
      <div id="rid-message" class="text-xs min-h-[1.25rem] text-center"></div>
      <div class="flex gap-3 pt-2 sticky bottom-0 bg-white pb-2"><button type="button" id="btn-cancelar-rid" class="flex-1 px-4 py-2.5 rounded-xl border border-[#b0b0b0] hover:bg-[#d6d6d4] text-[#2c2c2c] font-semibold transition-colors"> Cancelar </button> <button type="submit" id="btn-confirmar-rid" class="flex-1 px-4 py-2.5 rounded-xl bg-[#ffd57a] hover:bg-[#ffeab8] text-[#2c2c2c] font-semibold transition-colors disabled:opacity-70"> Criar RID </button>
      </div>
     </form>
    </div>
   </div><!-- Modal Cadastro Funcionário (Admin) -->
   <div id="modal-cadastro-funcionario" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl border border-[#b0b0b0] max-w-md w-full max-h-[90%] overflow-auto">
     <div class="px-6 py-4 border-b border-[#b0b0b0] flex items-center justify-between">
      <h3 class="text-lg font-semibold">Cadastrar Novo Funcionário</h3><button id="btn-fechar-modal-cadastro-func" class="w-8 h-8 rounded-full hover:bg-[#ece5df] flex items-center justify-center text-2xl">×</button>
     </div>
     <form id="form-cadastro-funcionario" class="px-6 py-6 space-y-4">
      <div><label for="cadastro-func-nome" class="block text-sm font-medium mb-1.5">Nome Completo</label> <input id="cadastro-func-nome" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" required>
      </div>
      <div><label for="cadastro-func-cpf" class="block text-sm font-medium mb-1.5">CPF</label> <input id="cadastro-func-cpf" type="text" maxlength="14" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" placeholder="000.000.000-00" required>
      </div>
      <div><label for="cadastro-func-setor" class="block text-sm font-medium mb-1.5">Setor</label> <select id="cadastro-func-setor" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" required> <option value="">Selecione</option> <option value="ADM">ADM</option> <option value="M. MOVEL">M. MOVEL</option> <option value="M. FIXA">M. FIXA</option> <option value="M. ELÉTRICA">M. ELÉTRICA</option> <option value="PRODUÇÃO">PRODUÇÃO</option> <option value="MINA">MINA</option> </select>
      </div>
      <div><label for="cadastro-func-matricula" class="block text-sm font-medium mb-1.5">Matrícula (Senha)</label> <input id="cadastro-func-matricula" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" placeholder="Digite a matrícula do funcionário" required>
       <p class="text-xs text-[#5a5a5a] mt-1">A matrícula será usada como senha de acesso (mínimo 6 caracteres)</p>
      </div>
      <div id="cadastro-func-message" class="text-xs min-h-[1.25rem]"></div>
      <div class="flex gap-3"><button type="button" id="btn-cancelar-cadastro-func" class="flex-1 px-4 py-2.5 rounded-xl border border-[#b0b0b0] hover:bg-[#d6d6d4]">Cancelar</button> <button type="submit" id="btn-confirmar-cadastro-func" class="flex-1 px-4 py-2.5 rounded-xl bg-[#ffd57a] hover:bg-[#ffeab8] font-semibold disabled:opacity-70"> Cadastrar </button>
      </div>
     </form>
    </div>
   </div><!-- Modal Detalhes RID -->
   <div id="modal-detalhes-rid" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl border border-[#b0b0b0] max-w-3xl w-full max-h-[90%] overflow-auto">
     <div class="px-6 py-4 border-b border-[#b0b0b0] flex items-center justify-between sticky top-0 bg-white z-10">
      <h3 class="text-lg font-semibold text-[#2c2c2c]">Detalhes do RID</h3><button id="btn-fechar-modal-detalhes" class="w-8 h-8 rounded-full hover:bg-[#ece5df] flex items-center justify-center text-2xl">×</button>
     </div>
     <form id="form-editar-rid" class="px-6 py-6 space-y-5">
      <div><label for="detalhes-numero" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Número do RID</label> <input id="detalhes-numero" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#d6d6d4] text-sm cursor-not-allowed opacity-75" readonly>
      </div>
      <div><label for="detalhes-emitente" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Emitente</label> <input id="detalhes-emitente" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required>
      </div>
      <div><label for="detalhes-tipo-contrato" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Tipo de contrato</label> <select id="detalhes-tipo-contrato" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Funcionário">Funcionário</option> <option value="Terceiro Contratado">Terceiro Contratado</option> <option value="Terceiro Eventual">Terceiro Eventual</option> <option value="Visitante">Visitante</option> </select>
      </div>
      <div><label for="detalhes-unidade" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Unidade</label> <input id="detalhes-unidade" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 uppercase" required>
      </div>
      <div><label for="detalhes-setor" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Setor do emitente</label> <select id="detalhes-setor" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="ADM">ADM</option> <option value="M. MOVEL">M. MOVEL</option> <option value="M. FIXA">M. FIXA</option> <option value="M. ELÉTRICA">M. ELÉTRICA</option> <option value="PRODUÇÃO">PRODUÇÃO</option> <option value="MINA">MINA</option> </select>
      </div>
      <div><label for="detalhes-data" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Data</label> <input id="detalhes-data" type="date" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required>
      </div>
      <div><label for="detalhes-incidente" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Incidente ou Desvios</label> <select id="detalhes-incidente" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Condição de Risco">Condição de Risco</option> <option value="Desvio Comportamental">Desvio Comportamental</option> <option value="Dano Material">Dano Material</option> <option value="Quase acidente">Quase acidente</option> </select>
      </div>
      <div><label for="detalhes-origem" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Origem da detecção</label> <select id="detalhes-origem" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="CSL">CSL</option> <option value="Inspeção programada">Inspeção programada</option> <option value="Inspeção não programada">Inspeção não programada</option> <option value="Observação Comportamental">Observação Comportamental</option> <option value="Constatação espontânea">Constatação espontânea</option> <option value="Auditoria">Auditoria</option> </select>
      </div>
      <div><label for="detalhes-local" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Local da ocorrência</label> <input id="detalhes-local" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required>
      </div>
      <div><label for="detalhes-descricao" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Descrição da Ocorrência</label> <textarea id="detalhes-descricao" rows="4" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 resize-none" required></textarea>
      </div>
      <div><label for="detalhes-acao-imediata" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Ação Imediata</label> <textarea id="detalhes-acao-imediata" rows="3" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 resize-none" required></textarea>
      </div>
      <div><label for="detalhes-classificacao" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Classificação de risco</label> <select id="detalhes-classificacao" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Baixo">Baixo - Risco mínimo, sem impacto significativo</option> <option value="Médio">Médio - Risco moderado, requer atenção</option> <option value="Alto">Alto - Risco elevado, ação urgente necessária</option> <option value="Crítico">Crítico - Risco extremo, ação imediata obrigatória</option> </select>
      </div>
      <div><label for="detalhes-status" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Status</label> <select id="detalhes-status" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione</option> <option value="Em Andamento">EM ANDAMENTO - O problema está sendo tratado</option> <option value="Corrigido">CORRIGIDO - O problema foi resolvido completamente</option> <option value="Vencido">VENCIDO - O prazo de correção foi ultrapassado</option> </select>
      </div>
      <div><label for="detalhes-lider" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Líder Designado (Opcional)</label> <select id="detalhes-lider" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40"> <option value="">Selecione um líder</option> </select>
      </div>
      <div class="bg-blue-50 border border-blue-300 rounded-xl p-4">
       <div class="flex items-start gap-3 mb-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
        </svg>
        <div>
         <p class="text-sm font-semibold text-blue-800 mb-1">Designar Líder Responsável</p>
         <p class="text-xs text-blue-700">Atribua um líder para acompanhar este RID com prazo e observações específicas.</p>
        </div>
       </div><button type="button" id="btn-abrir-designacao" class="w-full px-4 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold transition-colors flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
        </svg> Designar Líder para este RID </button>
      </div>
      <div id="detalhes-message" class="text-xs min-h-[1.25rem] text-center"></div>
      <div class="flex gap-3 pt-2 sticky bottom-0 bg-white pb-2"><button type="button" id="btn-cancelar-detalhes" class="flex-1 px-4 py-2.5 rounded-xl border border-[#b0b0b0] hover:bg-[#d6d6d4] text-[#2c2c2c] font-semibold transition-colors"> Cancelar </button> <button type="submit" id="btn-salvar-detalhes" class="flex-1 px-4 py-2.5 rounded-xl bg-[#ffd57a] hover:bg-[#ffeab8] text-[#2c2c2c] font-semibold transition-colors disabled:opacity-70"> Salvar Alterações </button>
      </div>
     </form>
    </div>
   </div><!-- Modal Designar Líder -->
   <div id="modal-designar-lider" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl border border-[#b0b0b0] max-w-md w-full max-h-[90%] overflow-auto">
     <div class="px-6 py-4 border-b border-[#b0b0b0] flex items-center justify-between">
      <h3 class="text-lg font-semibold text-[#2c2c2c]">Designar Líder para RID</h3><button id="btn-fechar-modal-designar" class="w-8 h-8 rounded-full hover:bg-[#ece5df] flex items-center justify-center text-2xl">   </button>
     </div>
     <form id="form-designar-lider" class="px-6 py-6 space-y-4">
      <div class="bg-blue-50 border border-blue-300 rounded-xl p-4">
       <div class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
        </svg>
        <div>
         <p class="text-sm font-semibold text-blue-800 mb-1">Informação</p>
         <p class="text-xs text-blue-700">Designe um líder responsável para acompanhar e gerenciar este RID.</p>
        </div>
       </div>
      </div>
      <div><label for="designar-rid-numero" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">RID</label> <input id="designar-rid-numero" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#d6d6d4] text-sm cursor-not-allowed opacity-75" readonly required>
      </div>
      <div><label for="designar-lider-select" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Designar para</label> <select id="designar-lider-select" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required> <option value="">Selecione um administrador</option> </select>
      </div>
      <div><label for="designar-prazo" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Prazo para conclusão</label> <input id="designar-prazo" type="date" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40" required>
      </div>
      <div><label for="designar-observacao" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Observação</label> <textarea id="designar-observacao" rows="4" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 resize-none" placeholder="Adicione observações ou instruções para o líder designado"></textarea>
      </div>
      <div id="designar-message" class="text-xs min-h-[1.25rem] text-center"></div>
      <div class="flex gap-3 pt-2"><button type="button" id="btn-cancelar-designar" class="flex-1 px-4 py-2.5 rounded-xl border border-[#b0b0b0] hover:bg-[#d6d6d4] text-[#2c2c2c] font-semibold transition-colors"> Cancelar </button> <button type="submit" id="btn-confirmar-designar" class="flex-1 px-4 py-2.5 rounded-xl bg-[#ffd57a] hover:bg-[#ffeab8] text-[#2c2c2c] font-semibold transition-colors disabled:opacity-70"> Designar Líder </button>
      </div>
     </form>
    </div>
   </div><!-- Modal Solicitar Exclusão -->
   <div id="modal-solicitar-exclusao" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl border border-[#b0b0b0] max-w-md w-full max-h-[90%] overflow-auto">
     <div class="px-6 py-4 border-b border-[#b0b0b0] flex items-center justify-between">
      <h3 class="text-lg font-semibold text-[#2c2c2c]">Solicitar Exclusão</h3><button id="btn-fechar-modal-exclusao" class="w-8 h-8 rounded-full hover:bg-[#ece5df] flex items-center justify-center text-2xl">×</button>
     </div>
     <form id="form-solicitar-exclusao" class="px-6 py-6 space-y-4">
      <div class="bg-yellow-50 border border-yellow-300 rounded-xl p-4">
       <div class="flex items-start gap-3">
        <svg class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
        <div>
         <p class="text-sm font-semibold text-yellow-800 mb-1">Atenção</p>
         <p class="text-xs text-yellow-700">Esta solicitação será enviada aos administradores desenvolvedores para análise. A exclusão s       será realizada após aprovação.</p>
        </div>
       </div>
      </div>
      <div><label for="exclusao-item" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Item a ser excluído</label> <input id="exclusao-item" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#d6d6d4] text-sm cursor-not-allowed opacity-75" readonly required>
      </div>
      <div><label for="exclusao-motivo" class="block text-sm font-medium text-[#2c2c2c] mb-1.5">Motivo da solicitação</label> <textarea id="exclusao-motivo" rows="4" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df] text-sm focus:border-[#ffd57a] focus:ring-2 focus:ring-[#ffd57a]/40 resize-none" placeholder="Descreva o motivo da solicitação de exclusão" required></textarea>
      </div>
      <div id="exclusao-message" class="text-xs min-h-[1.25rem] text-center"></div>
      <div class="flex gap-3 pt-2"><button type="button" id="btn-cancelar-exclusao" class="flex-1 px-4 py-2.5 rounded-xl border border-[#b0b0b0] hover:bg-[#d6d6d4] text-[#2c2c2c] font-semibold transition-colors"> Cancelar </button> <button type="submit" id="btn-confirmar-exclusao" class="flex-1 px-4 py-2.5 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold transition-colors disabled:opacity-70"> Enviar Solicitação </button>
      </div>
     </form>
    </div>
   </div><!-- Modal Cadastro -->
   <div id="modal-cadastro" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl border border-[#b0b0b0] max-w-md w-full max-h-[90%] overflow-auto">
     <div class="px-6 py-4 border-b border-[#b0b0b0] flex items-center justify-between">
      <h3 class="text-lg font-semibold">Criar Nova Conta</h3><button id="btn-fechar-modal-cadastro" class="w-8 h-8 rounded-full hover:bg-[#ece5df] flex items-center justify-center text-2xl">×</button>
     </div>
     <form id="form-cadastro" class="px-6 py-6 space-y-4">
      <div><label for="cadastro-nome" class="block text-sm font-medium mb-1.5">Nome Completo</label> <input id="cadastro-nome" type="text" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" required>
      </div>
      <div><label for="cadastro-cpf" class="block text-sm font-medium mb-1.5">CPF</label> <input id="cadastro-cpf" type="text" maxlength="14" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" placeholder="000.000.000-00" required>
      </div>
      <div><label for="cadastro-setor" class="block text-sm font-medium mb-1.5">Setor</label> <select id="cadastro-setor" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" required> <option value="">Selecione</option> <option value="ADM">ADM</option> <option value="M. MOVEL">M. MOVEL</option> <option value="M. FIXA">M. FIXA</option> <option value="M. ELÉTRICA">M. ELÉTRICA</option> <option value="PRODUÇÃO">PRODUÇÃO</option> <option value="MINA">MINA</option> </select>
      </div>
      <div><label for="cadastro-senha" class="block text-sm font-medium mb-1.5">Senha</label> <input id="cadastro-senha" type="password" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" placeholder="Digite sua senha" required>
       <p class="text-xs text-[#5a5a5a] mt-1">Mínimo de 6 caracteres</p>
      </div>
      <div><label for="cadastro-confirmar-senha" class="block text-sm font-medium mb-1.5">Confirmar Senha</label> <input id="cadastro-confirmar-senha" type="password" class="block w-full px-3 py-2.5 rounded-xl border border-[#b0b0b0] bg-[#ece5df]" placeholder="Confirme sua senha" required>
      </div>
      <div id="cadastro-message" class="text-xs min-h-[1.25rem]"></div>
      <div class="flex gap-3"><button type="button" id="btn-cancelar-cadastro" class="flex-1 px-4 py-2.5 rounded-xl border border-[#b0b0b0] hover:bg-[#d6d6d4]">Cancelar</button> <button type="submit" id="btn-confirmar-cadastro" class="flex-1 px-4 py-2.5 rounded-xl bg-[#ffd57a] hover:bg-[#ffeab8] font-semibold disabled:opacity-70"> Criar Conta </button>
      </div>
     </form>
    </div>
   </div>
  </main>
  <script type="module">
  async function waitForFirebase() {
    if (window.firebaseReady) return;
    return new Promise(resolve => {
      window.addEventListener('firebaseReady', resolve, { once: true });
    });
  }

  await waitForFirebase();

  const auth = window.firebaseAuth;
  const db = window.firebaseDb;
  const {
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    onAuthStateChanged,
    signOut,
    collection,
    addDoc,
    getDocs,
    updateDoc,
    deleteDoc,
    doc,
    query,
    where,
    serverTimestamp
  } = window.firebaseModules;

  let currentUser = null;
  let isCreatingUser = false;

  const LISTA_ADMINISTRATIVOS = [
    '12958477080',
    '20831765041',
    '31590792002',
    '42761954073',
    '53810286010',
    '64973512059',
    '75049831008',
    '86127094000',
    '97285376024',
    '08461953005',
    '19540728060',
    '20689147019',
    '31756089072',
    '42890361034',
    '86249751012',
    '97310826001'
  ];

  const LISTA_DESENVOLVEDORES = [
    '53974682007',
    '64058293098',
    '75130974040'
  ];

  function formatCPF(value) {
    const numbers = value.replace(/\D/g, '');
    if (numbers.length <= 3) return numbers;
    if (numbers.length <= 6) return numbers.slice(0, 3) + '.' + numbers.slice(3);
    if (numbers.length <= 9) return numbers.slice(0, 3) + '.' + numbers.slice(3, 6) + '.' + numbers.slice(6);
    return numbers.slice(0, 3) + '.' + numbers.slice(3, 6) + '.' + numbers.slice(6, 9) + '-' + numbers.slice(9, 11);
  }

  function validarCPF(cpf) {
    return cpf.replace(/\D/g, '').length === 11;
  }

  function showMessage(elementId, message, type = 'error') {
    const msgElement = document.getElementById(elementId);
    if (!msgElement) return;
    
    msgElement.textContent = message;
    msgElement.className = `text-xs min-h-[1.25rem] text-center ${type === 'error' ? 'text-red-600' : 'text-green-600'}`;
  }

  async function isAdmin(cpf) {
    const cpfLimpo = cpf.replace(/\D/g, '');
    return LISTA_ADMINISTRATIVOS.includes(cpfLimpo) || LISTA_DESENVOLVEDORES.includes(cpfLimpo);
  }

  function showView(name) {
    document.getElementById('view-login').classList.add('hidden');
    document.getElementById('view-admin').classList.add('hidden');
    document.getElementById('view-func').classList.add('hidden');

    if (name === 'login') {
      document.getElementById('view-login').classList.remove('hidden');
    } else if (name === 'admin') {
      document.getElementById('view-admin').classList.remove('hidden');
    } else if (name === 'func') {
      document.getElementById('view-func').classList.remove('hidden');
    }
  }

  document.getElementById('cpf-login').addEventListener('input', (e) => {
    e.target.value = formatCPF(e.target.value);
  });

  document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const cpfInput = document.getElementById('cpf-login').value.trim();
    const senha = document.getElementById('senha-login').value;
    const btn = document.getElementById('btn-entrar');
    
    const cpfLimpo = cpfInput.replace(/\D/g, '');
    
    if (!validarCPF(cpfLimpo)) {
      showMessage('login-message', 'CPF inválido', 'error');
      return;
    }
    
    btn.disabled = true;
    btn.textContent = 'Entrando...';
    showMessage('login-message', '', 'error');
    
    try {
      const usersRef = collection(db, 'users');
      const q = query(usersRef, where('cpf', '==', cpfLimpo));
      const querySnapshot = await getDocs(q);
      
      if (querySnapshot.empty) {
        showMessage('login-message', 'CPF não encontrado. Crie uma conta primeiro.', 'error');
        btn.disabled = false;
        btn.textContent = 'Entrar';
        return;
      }
      
      const userData = querySnapshot.docs[0].data();
      const emailUsuario = `${cpfLimpo}@jdemito.com`;
      
      await signInWithEmailAndPassword(auth, emailUsuario, senha);
      
      showMessage('login-message', 'Login realizado com sucesso!', 'success');
      
    } catch (error) {
      console.error('Erro no login:', error);
      
      if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
        showMessage('login-message', 'CPF ou senha incorretos', 'error');
      } else {
        showMessage('login-message', 'Erro ao fazer login. Tente novamente.', 'error');
      }
      
      btn.disabled = false;
      btn.textContent = 'Entrar';
    }
  });

  document.getElementById('btn-cadastrar-funcionario').addEventListener('click', () => {
    document.getElementById('modal-cadastro-funcionario').classList.remove('hidden');
  });
  
  document.getElementById('btn-fechar-modal-cadastro-func').addEventListener('click', () => {
    document.getElementById('modal-cadastro-funcionario').classList.add('hidden');
  });
  
  document.getElementById('btn-cancelar-cadastro-func').addEventListener('click', () => {
    document.getElementById('modal-cadastro-funcionario').classList.add('hidden');
  });
  
  document.getElementById('cadastro-func-cpf').addEventListener('input', (e) => {
    e.target.value = formatCPF(e.target.value);
  });
  
  document.getElementById('form-cadastro-funcionario').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const nome = document.getElementById('cadastro-func-nome').value.trim().toUpperCase();
    const cpf = document.getElementById('cadastro-func-cpf').value.replace(/\D/g, '');
    const setor = document.getElementById('cadastro-func-setor').value;
    const matricula = document.getElementById('cadastro-func-matricula').value;
    const btn = document.getElementById('btn-confirmar-cadastro-func');
    const msg = document.getElementById('cadastro-func-message');
    
    if (!validarCPF(cpf)) {
      msg.textContent = 'CPF inválido';
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
      return;
    }
    
    if (matricula.length < 6) {
      msg.textContent = 'A matrícula deve ter no mínimo 6 caracteres';
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
      return;
    }
    
    btn.disabled = true;
    btn.textContent = 'Cadastrando...';
    msg.textContent = '';
    
    try {
      const usersRef = collection(db, 'users');
      const qCpf = query(usersRef, where('cpf', '==', cpf));
      const cpfSnapshot = await getDocs(qCpf);
      
      if (!cpfSnapshot.empty) {
        msg.textContent = 'CPF já cadastrado';
        msg.className = 'text-xs min-h-[1.25rem] text-red-600';
        btn.disabled = false;
        btn.textContent = 'Cadastrar';
        return;
      }
      
      const usuarioAdminLogado = currentUser;
      let adminEmail = null;
      let adminSenha = null;
      
      if (usuarioAdminLogado) {
        adminEmail = usuarioAdminLogado.email;
        const adminQuery = query(usersRef, where('uid', '==', usuarioAdminLogado.uid));
        const adminSnapshot = await getDocs(adminQuery);
        if (!adminSnapshot.empty) {
          adminSenha = adminSnapshot.docs[0].data().senha;
        }
      }
      
      isCreatingUser = true;
      
      const emailFicticio = `${cpf}@jdemito.com`;
      const tipo = 'funcionario';
      
      const userCredential = await createUserWithEmailAndPassword(auth, emailFicticio, matricula);
      const novoUID = userCredential.user.uid;
      
      await addDoc(usersRef, {
        uid: novoUID,
        nome,
        cpf,
        email: emailFicticio,
        setor,
        senha: matricula,
        tipo,
        data_criacao: serverTimestamp()
      });
      
      if (usuarioAdminLogado && adminEmail && adminSenha) {
        await signOut(auth);
        await signInWithEmailAndPassword(auth, adminEmail, adminSenha);
      }
      
      isCreatingUser = false;
      
      msg.textContent = 'Funcionário cadastrado com sucesso!';
      msg.className = 'text-xs min-h-[1.25rem] text-green-600';
      
      setTimeout(() => {
        document.getElementById('modal-cadastro-funcionario').classList.add('hidden');
        document.getElementById('form-cadastro-funcionario').reset();
        msg.textContent = '';
        loadFuncionariosTable();
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao cadastrar funcionário:', error);
      
      isCreatingUser = false;
      
      let mensagemErro = 'Erro ao cadastrar funcionário. Tente novamente.';
      
      if (error.code === 'auth/email-already-in-use') {
        mensagemErro = 'CPF já cadastrado no sistema';
      } else if (error.code === 'auth/weak-password') {
        mensagemErro = 'A matrícula deve ter no mínimo 6 caracteres';
      }
      
      msg.textContent = mensagemErro;
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
    } finally {
      btn.disabled = false;
      btn.textContent = 'Cadastrar';
    }
  });

  document.getElementById('btn-cadastrar').addEventListener('click', () => {
    document.getElementById('modal-cadastro').classList.remove('hidden');
  });
  
  document.getElementById('btn-fechar-modal-cadastro').addEventListener('click', () => {
    document.getElementById('modal-cadastro').classList.add('hidden');
  });
  
  document.getElementById('btn-cancelar-cadastro').addEventListener('click', () => {
    document.getElementById('modal-cadastro').classList.add('hidden');
  });
  
  document.getElementById('cadastro-cpf').addEventListener('input', (e) => {
    e.target.value = formatCPF(e.target.value);
  });
  
  document.getElementById('form-cadastro').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const nome = document.getElementById('cadastro-nome').value.trim().toUpperCase();
    const cpf = document.getElementById('cadastro-cpf').value.replace(/\D/g, '');
    const setor = document.getElementById('cadastro-setor').value;
    const senha = document.getElementById('cadastro-senha').value;
    const confirmarSenha = document.getElementById('cadastro-confirmar-senha').value;
    const btn = document.getElementById('btn-confirmar-cadastro');
    const msg = document.getElementById('cadastro-message');
    
    if (!validarCPF(cpf)) {
      msg.textContent = 'CPF inválido';
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
      return;
    }
    
    if (senha.length < 6) {
      msg.textContent = 'A senha deve ter no mínimo 6 caracteres';
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
      return;
    }
    
    if (senha !== confirmarSenha) {
      msg.textContent = 'As senhas n      o coincidem';
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
      return;
    }
    
    btn.disabled = true;
    btn.textContent = 'Criando...';
    msg.textContent = '';
    
    try {
      const usersRef = collection(db, 'users');
      const qCpf = query(usersRef, where('cpf', '==', cpf));
      const cpfSnapshot = await getDocs(qCpf);
      
      if (!cpfSnapshot.empty) {
        msg.textContent = 'CPF j   cadastrado';
        msg.className = 'text-xs min-h-[1.25rem] text-red-600';
        btn.disabled = false;
        btn.textContent = 'Criar Conta';
        return;
      }
      
      const usuarioAdminLogado = currentUser;
      let adminEmail = null;
      let adminSenha = null;
      
      if (usuarioAdminLogado) {
        adminEmail = usuarioAdminLogado.email;
        const adminQuery = query(usersRef, where('uid', '==', usuarioAdminLogado.uid));
        const adminSnapshot = await getDocs(adminQuery);
        if (!adminSnapshot.empty) {
          adminSenha = adminSnapshot.docs[0].data().senha;
        }
      }
      
      isCreatingUser = true;
      
      const emailFicticio = `${cpf}@jdemito.com`;
      
      const tipo = 'funcionario';
      
      const userCredential = await createUserWithEmailAndPassword(auth, emailFicticio, senha);
      const novoUID = userCredential.user.uid;
      
      await addDoc(usersRef, {
        uid: novoUID,
        nome,
        cpf,
        email: emailFicticio,
        setor,
        senha: senha,
        tipo,
        data_criacao: serverTimestamp()
      });
      
      if (usuarioAdminLogado && adminEmail && adminSenha) {
        await signOut(auth);
        await signInWithEmailAndPassword(auth, adminEmail, adminSenha);
      }
      
      isCreatingUser = false;
      
      msg.textContent = 'Cadastro criado com sucesso!';
      msg.className = 'text-xs min-h-[1.25rem] text-green-600';
      
      setTimeout(() => {
        document.getElementById('modal-cadastro').classList.add('hidden');
        document.getElementById('form-cadastro').reset();
        msg.textContent = '';
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao criar conta:', error);
      
      isCreatingUser = false;
      
      let mensagemErro = 'Erro ao criar conta. Tente novamente.';
      
      if (error.code === 'auth/email-already-in-use') {
        mensagemErro = 'CPF já cadastrado no sistema';
      } else if (error.code === 'auth/weak-password') {
        mensagemErro = 'A senha deve ter no mínimo 6 caracteres';
      }
      
      msg.textContent = mensagemErro;
      msg.className = 'text-xs min-h-[1.25rem] text-red-600';
    } finally {
      btn.disabled = false;
      btn.textContent = 'Criar Conta';
    }
  });

  function showAdminSection(sectionName) {
    document.getElementById('admin-section-dashboard').classList.add('hidden');
    document.getElementById('admin-section-rids').classList.add('hidden');
    document.getElementById('admin-section-funcionarios').classList.add('hidden');
    document.getElementById('admin-section-solicitacoes').classList.add('hidden');
    document.getElementById('admin-section-relatorios').classList.add('hidden');

    const activeClass = 'px-4 py-2 rounded-full bg-[#ffd57a] text-[#2c2c2c] font-semibold';
    const inactiveClass = 'px-4 py-2 rounded-full text-[#2c2c2c] hover:bg-[#ece5df] transition-colors';
    
    document.getElementById('btn-nav-dashboard').className = inactiveClass;
    document.getElementById('btn-nav-rids').className = inactiveClass;
    document.getElementById('btn-nav-funcionarios').className = inactiveClass;
    document.getElementById('btn-nav-solicitacoes').className = inactiveClass;
    document.getElementById('btn-nav-relatorios').className = inactiveClass;

    if (sectionName === 'dashboard') {
      document.getElementById('admin-section-dashboard').classList.remove('hidden');
      document.getElementById('btn-nav-dashboard').className = activeClass;
    } else if (sectionName === 'rids') {
      document.getElementById('admin-section-rids').classList.remove('hidden');
      document.getElementById('btn-nav-rids').className = activeClass;
    } else if (sectionName === 'funcionarios') {
      document.getElementById('admin-section-funcionarios').classList.remove('hidden');
      document.getElementById('btn-nav-funcionarios').className = activeClass;
    } else if (sectionName === 'solicitacoes') {
      document.getElementById('admin-section-solicitacoes').classList.remove('hidden');
      document.getElementById('btn-nav-solicitacoes').className = activeClass;
    } else if (sectionName === 'relatorios') {
      document.getElementById('admin-section-relatorios').classList.remove('hidden');
      document.getElementById('btn-nav-relatorios').className = activeClass;
    }
  }

  function setupNavigationButtons() {
    const btnNavDashboard = document.getElementById('btn-nav-dashboard');
    const btnNavRids = document.getElementById('btn-nav-rids');
    const btnNavFuncionarios = document.getElementById('btn-nav-funcionarios');
    const btnNavSolicitacoes = document.getElementById('btn-nav-solicitacoes');
    const btnNavRelatorios = document.getElementById('btn-nav-relatorios');

    if (btnNavDashboard) {
      btnNavDashboard.addEventListener('click', () => {
        showAdminSection('dashboard');
        loadDashboardData();
      });
    }

    if (btnNavRids) {
      btnNavRids.addEventListener('click', () => {
        showAdminSection('rids');
        loadRidsTable();
      });
    }

    if (btnNavFuncionarios) {
      btnNavFuncionarios.addEventListener('click', () => {
        showAdminSection('funcionarios');
        loadFuncionariosTable();
      });
    }

    if (btnNavSolicitacoes) {
      btnNavSolicitacoes.addEventListener('click', () => {
        showAdminSection('solicitacoes');
        loadSolicitacoesTable();
      });
    }

    if (btnNavRelatorios) {
      btnNavRelatorios.addEventListener('click', () => {
        showAdminSection('relatorios');
        loadRelatoriosTable();
      });
    }
  }

  setupNavigationButtons();

  document.getElementById('btn-menu-admin').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-menu-admin').classList.toggle('hidden');
  });

  document.getElementById('btn-menu-func').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-menu-func').classList.toggle('hidden');
  });

  document.getElementById('btn-notificacoes-admin').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-notificacoes-admin').classList.toggle('hidden');
  });

  document.getElementById('btn-notificacoes-func').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-notificacoes-func').classList.toggle('hidden');
  });

  document.getElementById('btn-filtro-visao').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-filtro-visao').classList.toggle('hidden');
  });

  document.getElementById('btn-filtro-ranking').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-filtro-ranking').classList.toggle('hidden');
  });

  document.getElementById('btn-filtro-relatorios').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-filtro-relatorios').classList.toggle('hidden');
  });

  document.getElementById('btn-filtro-rids').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('dropdown-filtro-rids').classList.toggle('hidden');
  });

  document.addEventListener('click', (e) => {
    const dropdownAdmin = document.getElementById('dropdown-menu-admin');
    const dropdownFunc = document.getElementById('dropdown-menu-func');
    const dropdownNotifAdmin = document.getElementById('dropdown-notificacoes-admin');
    const dropdownNotifFunc = document.getElementById('dropdown-notificacoes-func');
    const dropdownFiltroVisao = document.getElementById('dropdown-filtro-visao');
    const dropdownFiltroRanking = document.getElementById('dropdown-filtro-ranking');
    const dropdownFiltroRelatorios = document.getElementById('dropdown-filtro-relatorios');
    const dropdownFiltroRids = document.getElementById('dropdown-filtro-rids');
    const btnAdmin = document.getElementById('btn-menu-admin');
    const btnFunc = document.getElementById('btn-menu-func');
    const btnNotifAdmin = document.getElementById('btn-notificacoes-admin');
    const btnNotifFunc = document.getElementById('btn-notificacoes-func');
    const btnFiltroVisao = document.getElementById('btn-filtro-visao');
    const btnFiltroRanking = document.getElementById('btn-filtro-ranking');
    const btnFiltroRelatorios = document.getElementById('btn-filtro-relatorios');
    const btnFiltroRids = document.getElementById('btn-filtro-rids');
    
    if (dropdownAdmin && !dropdownAdmin.classList.contains('hidden')) {
      if (!btnAdmin.contains(e.target) && !dropdownAdmin.contains(e.target)) {
        dropdownAdmin.classList.add('hidden');
      }
    }
    
    if (dropdownFunc && !dropdownFunc.classList.contains('hidden')) {
      if (!btnFunc.contains(e.target) && !dropdownFunc.contains(e.target)) {
        dropdownFunc.classList.add('hidden');
      }
    }

    if (dropdownNotifAdmin && !dropdownNotifAdmin.classList.contains('hidden')) {
      if (!btnNotifAdmin.contains(e.target) && !dropdownNotifAdmin.contains(e.target)) {
        dropdownNotifAdmin.classList.add('hidden');
      }
    }

    if (dropdownNotifFunc && !dropdownNotifFunc.classList.contains('hidden')) {
      if (!btnNotifFunc.contains(e.target) && !dropdownNotifFunc.contains(e.target)) {
        dropdownNotifFunc.classList.add('hidden');
      }
    }

    if (dropdownFiltroVisao && !dropdownFiltroVisao.classList.contains('hidden')) {
      if (!btnFiltroVisao.contains(e.target) && !dropdownFiltroVisao.contains(e.target)) {
        dropdownFiltroVisao.classList.add('hidden');
      }
    }

    if (dropdownFiltroRanking && !dropdownFiltroRanking.classList.contains('hidden')) {
      if (!btnFiltroRanking.contains(e.target) && !dropdownFiltroRanking.contains(e.target)) {
        dropdownFiltroRanking.classList.add('hidden');
      }
    }

    if (dropdownFiltroRelatorios && !dropdownFiltroRelatorios.classList.contains('hidden')) {
      if (!btnFiltroRelatorios.contains(e.target) && !dropdownFiltroRelatorios.contains(e.target)) {
        dropdownFiltroRelatorios.classList.add('hidden');
      }
    }

    if (dropdownFiltroRids && !dropdownFiltroRids.classList.contains('hidden')) {
      if (!btnFiltroRids.contains(e.target) && !dropdownFiltroRids.contains(e.target)) {
        dropdownFiltroRids.classList.add('hidden');
      }
    }
  });

  document.getElementById('btn-logout-admin').addEventListener('click', async () => {
    await signOut(auth);
    showView('login');
    
    // Resetar o botão de login
    const btnEntrar = document.getElementById('btn-entrar');
    btnEntrar.disabled = false;
    btnEntrar.textContent = 'Entrar';
    
    // Limpar formulário de login
    document.getElementById('login-form').reset();
    showMessage('login-message', '', 'error');
  });

  document.getElementById('btn-logout-func').addEventListener('click', async () => {
    await signOut(auth);
    showView('login');
    
    // Resetar o botão de login
    const btnEntrar = document.getElementById('btn-entrar');
    btnEntrar.disabled = false;
    btnEntrar.textContent = 'Entrar';
    
    // Limpar formulário de login
    document.getElementById('login-form').reset();
    showMessage('login-message', '', 'error');
  });

  async function carregarAdministradores() {
    try {
      const selectLider = document.getElementById('rid-lider');
      selectLider.innerHTML = '<option value="">Selecione um líder</option>';
      
      const usersRef = collection(db, 'users');
      const usersSnapshot = await getDocs(usersRef);
      
      usersSnapshot.forEach((docSnap) => {
        const user = docSnap.data();
        const cpfLimpo = (user.cpf || '').replace(/\D/g, '');
        const ehAdmin = LISTA_ADMINISTRATIVOS.includes(cpfLimpo);
        const ehDesenvolvedor = LISTA_DESENVOLVEDORES.includes(cpfLimpo);
        
        if (ehAdmin || ehDesenvolvedor) {
          const option = document.createElement('option');
          option.value = user.nome || '';
          option.textContent = user.nome || 'Sem nome';
          selectLider.appendChild(option);
        }
      });
      
    } catch (error) {
      console.error('Erro ao carregar administradores:', error);
      const selectLider = document.getElementById('rid-lider');
      selectLider.innerHTML = '<option value="">Erro ao carregar administradores</option>';
    }
  }

  document.getElementById('btn-criar-rid-func').addEventListener('click', async () => {
    document.getElementById('modal-criar-rid').classList.remove('hidden');
    
    try {
      const usersRef = collection(db, 'users');
      const q = query(usersRef, where('uid', '==', currentUser.uid));
      const querySnapshot = await getDocs(q);
      
      if (!querySnapshot.empty) {
        const userData = querySnapshot.docs[0].data();
        const nomeUsuario = userData.nome || '';
        document.getElementById('rid-emitente').value = nomeUsuario;
      }
      
      await carregarAdministradores();
    } catch (error) {
      console.error('Erro ao carregar dados do usuário:', error);
    }
  });

  document.getElementById('btn-criar-rid').addEventListener('click', async () => {
    document.getElementById('modal-criar-rid').classList.remove('hidden');
    
    try {
      const usersRef = collection(db, 'users');
      const q = query(usersRef, where('uid', '==', currentUser.uid));
      const querySnapshot = await getDocs(q);
      
      if (!querySnapshot.empty) {
        const userData = querySnapshot.docs[0].data();
        const nomeUsuario = userData.nome || '';
        document.getElementById('rid-emitente').value = nomeUsuario;
      }
      
      await carregarAdministradores();
    } catch (error) {
      console.error('Erro ao carregar dados do usuário:', error);
    }
  });

  document.getElementById('btn-fechar-modal-rid').addEventListener('click', () => {
    document.getElementById('modal-criar-rid').classList.add('hidden');
    document.getElementById('form-criar-rid').reset();
  });

  document.getElementById('btn-cancelar-rid').addEventListener('click', () => {
    document.getElementById('modal-criar-rid').classList.add('hidden');
    document.getElementById('form-criar-rid').reset();
  });

  document.getElementById('form-criar-rid').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const btn = document.getElementById('btn-confirmar-rid');
    btn.disabled = true;
    btn.textContent = 'Criando...';
    
    try {
      const ridsRef = collection(db, 'rids');
      const ridsSnapshot = await getDocs(ridsRef);
      const numeroRID = `RID-${String(ridsSnapshot.size + 1).padStart(4, '0')}`;
      
      const ridData = {
        numero: numeroRID,
        nome_emitente: document.getElementById('rid-emitente').value,
        tipo_contrato: document.getElementById('rid-tipo-contrato').value,
        unidade: document.getElementById('rid-unidade').value.toUpperCase(),
        setor: document.getElementById('rid-setor').value,
        data: document.getElementById('rid-data').value,
        origem_deteccao: document.getElementById('rid-origem').value,
        local_ocorrencia: document.getElementById('rid-local').value,
        descricao: document.getElementById('rid-descricao').value,
        acao_imediata: document.getElementById('rid-acao-imediata').value,
        classificacao_risco: document.getElementById('rid-classificacao').value,
        status: document.getElementById('rid-status').value,
        lider_designado: document.getElementById('rid-lider').value || null,
        data_criacao: serverTimestamp()
      };
      
      await addDoc(ridsRef, ridData);
      
      showMessage('rid-message', 'RID criado com sucesso!', 'success');
      
      setTimeout(() => {
        document.getElementById('modal-criar-rid').classList.add('hidden');
        document.getElementById('form-criar-rid').reset();
        
        const usersRef = collection(db, 'users');
        const q = query(usersRef, where('uid', '==', currentUser.uid));
        getDocs(q).then(querySnapshot => {
          if (!querySnapshot.empty) {
            const userData = querySnapshot.docs[0].data();
            const cpfUsuario = userData.cpf || '';
            
            isAdmin(cpfUsuario).then(ehAdmin => {
              if (ehAdmin) {
                loadRidsTable();
                loadDashboardData();
              } else {
                loadFuncRids(userData.nome);
              }
            });
          }
        });
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao criar RID:', error);
      showMessage('rid-message', 'Erro ao criar RID. Tente novamente.', 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Criar RID';
    }
  });

  async function loadFuncRids(nomeEmitente) {
    try {
      const tbody = document.getElementById('func-rids-table-body');
      tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando seus RIDs...</td></tr>';
      
      const ridsRef = collection(db, 'rids');
      const q = query(ridsRef, where('nome_emitente', '==', nomeEmitente));
      const ridsSnapshot = await getDocs(q);
      
      if (ridsSnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Você ainda não criou nenhum RID</td></tr>';
        return;
      }
      
      tbody.innerHTML = '';
      
      // Coletar todos os RIDs e ordenar por número
      const ridsArray = [];
      ridsSnapshot.forEach((docSnap) => {
        ridsArray.push({ id: docSnap.id, ...docSnap.data() });
      });
      
      // Ordenar por número do RID (ordem crescente de emissão)
      ridsArray.sort((a, b) => {
        const numA = parseInt((a.numero || 'RID-0').replace('RID-', '')) || 0;
        const numB = parseInt((b.numero || 'RID-0').replace('RID-', '')) || 0;
        return numA - numB;
      });
      
      ridsArray.forEach((ridData) => {
        const rid = ridData;
        
        let statusClass = 'bg-blue-100 text-blue-800 border-blue-300';
        const status = rid.status || 'Em Andamento';
        if (status === 'Corrigido') {
          statusClass = 'bg-green-100 text-green-800 border-green-300';
        } else if (status === 'Vencido') {
          statusClass = 'bg-red-100 text-red-800 border-red-300';
        }
        
        const dataFormatada = rid.data ? new Date(rid.data).toLocaleDateString('pt-BR') : 'N/A';
        
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#ece5df] transition-colors';
        
        tr.innerHTML = `
          <td class="px-4 py-3 text-sm text-[#2c2c2c] font-semibold">${rid.numero || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${rid.unidade || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${dataFormatada}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${rid.local_ocorrencia || 'N/A'}</td>
          <td class="px-4 py-3 text-sm">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${statusClass}">
              ${status}
            </span>
          </td>
          <td class="px-4 py-3">
            <div class="flex items-center justify-center gap-2">
              <button class="btn-ver-detalhes w-8 h-8 flex items-center justify-center rounded-lg hover:bg-blue-50 text-blue-600 transition-colors" title="Ver Detalhes" data-rid-id="${ridData.id}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
    } catch (error) {
      console.error('Erro ao carregar RIDs do funcionário:', error);
      const tbody = document.getElementById('func-rids-table-body');
      tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-red-600">Erro ao carregar seus RIDs</td></tr>';
    }
  }

  async function loadDashboardData() {
    try {
      const ridsRef = collection(db, 'rids');
      const ridsSnapshot = await getDocs(ridsRef);
      
      const mesFiltro = document.getElementById('filtro-mes-visao').value;
      const anoFiltro = document.getElementById('filtro-ano-visao').value;
      
      let ridsFiltrados = [];
      
      ridsSnapshot.forEach((doc) => {
        const rid = doc.data();
        ridsFiltrados.push(rid);
      });
      
      if (mesFiltro || anoFiltro) {
        ridsFiltrados = ridsFiltrados.filter(rid => {
          if (!rid.data) return false;
          
          const dataRid = new Date(rid.data);
          const mesRid = String(dataRid.getMonth() + 1).padStart(2, '0');
          const anoRid = String(dataRid.getFullYear());
          
          let passaMes = true;
          let passaAno = true;
          
          if (mesFiltro) {
            passaMes = mesRid === mesFiltro;
          }
          
          if (anoFiltro) {
            passaAno = anoRid === anoFiltro;
          }
          
          return passaMes && passaAno;
        });
      }
      
      const totalRids = ridsFiltrados.length;
      
      let emAndamento = 0;
      let vencidos = 0;
      let corrigidos = 0;
      
      ridsFiltrados.forEach((rid) => {
        const status = rid.status || '';
        
        if (status === 'Corrigido') {
          corrigidos++;
        } else if (status === 'Vencido') {
          vencidos++;
        } else {
          emAndamento++;
        }
      });
      
      document.getElementById('total-rids').textContent = totalRids;
      document.getElementById('rids-andamento').textContent = emAndamento;
      document.getElementById('rids-vencidos').textContent = vencidos;
      document.getElementById('rids-corrigidos').textContent = corrigidos;
      
      loadRidsRecentes();
      loadRankingEmissoes();
      
    } catch (error) {
      console.error('Erro ao carregar dados do dashboard:', error);
    }
  }

  async function loadRidsRecentes() {
    try {
      const container = document.getElementById('rids-recentes-container');
      container.innerHTML = '<div class="text-center py-8 text-[#5a5a5a]">Carregando RIDs recentes...</div>';
      
      const ridsRef = collection(db, 'rids');
      const ridsSnapshot = await getDocs(ridsRef);
      
      const hoje = new Date();
      const diaSemana = hoje.getDay();
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - diaSemana);
      inicioSemana.setHours(0, 0, 0, 0);
      
      const ridsRecentes = [];
      
      ridsSnapshot.forEach((doc) => {
        const rid = doc.data();
        if (rid.data_criacao) {
          const dataCriacao = rid.data_criacao.toDate ? rid.data_criacao.toDate() : new Date(rid.data_criacao);
          
          if (dataCriacao >= inicioSemana) {
            ridsRecentes.push({ id: doc.id, ...rid, dataCriacao });
          }
        }
      });
      
      ridsRecentes.sort((a, b) => b.dataCriacao - a.dataCriacao);
      
      if (ridsRecentes.length === 0) {
        container.innerHTML = '<div class="text-center py-8 text-[#5a5a5a]">Nenhum RID emitido esta semana</div>';
        return;
      }
      
      container.innerHTML = '';
      
      const table = document.createElement('table');
      table.className = 'w-full';
      
      const thead = document.createElement('thead');
      thead.className = 'bg-[#e8e7e6] border-b border-[#b0b0b0]';
      thead.innerHTML = `
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Número</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Emitente</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Setor</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Criado em</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-[#2c2c2c]">Status</th>
        </tr>
      `;
      table.appendChild(thead);
      
      const tbody = document.createElement('tbody');
      tbody.className = 'divide-y divide-[#b0b0b0]';
      
      ridsRecentes.slice(0, 10).forEach((rid) => {
        let statusClass = 'bg-blue-100 text-blue-800 border-blue-300';
        const status = rid.status || 'Em Andamento';
        if (status === 'Corrigido') {
          statusClass = 'bg-green-100 text-green-800 border-green-300';
        } else if (status === 'Vencido') {
          statusClass = 'bg-red-100 text-red-800 border-red-300';
        }
        
        const dataFormatada = rid.dataCriacao.toLocaleDateString('pt-BR', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
        
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#ece5df] transition-colors';
        
        tr.innerHTML = `
          <td class="px-4 py-3 text-sm text-[#2c2c2c] font-semibold">${rid.numero || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${rid.nome_emitente || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${rid.setor || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${dataFormatada}</td>
          <td class="px-4 py-3 text-sm">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${statusClass}">
              ${status}
            </span>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
      table.appendChild(tbody);
      container.appendChild(table);
      
    } catch (error) {
      console.error('Erro ao carregar RIDs recentes:', error);
      const container = document.getElementById('rids-recentes-container');
      container.innerHTML = '<div class="text-center py-8 text-red-600">Erro ao carregar RIDs recentes</div>';
    }
  }

  async function loadRankingEmissoes() {
    try {
      const container = document.getElementById('ranking-emissoes-container');
      container.innerHTML = '<div class="text-center py-8 text-[#5a5a5a]">Carregando ranking...</div>';
      
      const ridsRef = collection(db, 'rids');
      const ridsSnapshot = await getDocs(ridsRef);
      
      const mesFiltro = document.getElementById('filtro-mes-ranking').value;
      const anoFiltro = document.getElementById('filtro-ano-ranking').value;
      
      const contagemPorEmitente = {};
      
      ridsSnapshot.forEach((doc) => {
        const rid = doc.data();
        
        if (mesFiltro || anoFiltro) {
          if (!rid.data) return;
          
          const dataRid = new Date(rid.data);
          const mesRid = String(dataRid.getMonth() + 1).padStart(2, '0');
          const anoRid = String(dataRid.getFullYear());
          
          if (mesFiltro && mesRid !== mesFiltro) return;
          if (anoFiltro && anoRid !== anoFiltro) return;
        }
        
        const emitente = rid.nome_emitente || 'Desconhecido';
        
        if (!contagemPorEmitente[emitente]) {
          contagemPorEmitente[emitente] = {
            nome: emitente,
            setor: rid.setor || 'N/A',
            total: 0
          };
        }
        
        contagemPorEmitente[emitente].total++;
      });
      
      const ranking = Object.values(contagemPorEmitente)
        .sort((a, b) => b.total - a.total)
        .slice(0, 3);
      
      if (ranking.length === 0) {
        container.innerHTML = '<div class="text-center py-4 text-[#5a5a5a]">Nenhum RID emitido no período selecionado</div>';
        return;
      }
      
      container.innerHTML = '';
      
      const medalhas = ['🥇', '🥈', '🥉'];
      const coresGradiente = [
        'from-yellow-100 to-yellow-50 border-yellow-300',
        'from-gray-100 to-gray-50 border-gray-300',
        'from-orange-100 to-orange-50 border-orange-300'
      ];
      
      ranking.forEach((funcionario, index) => {
        const card = document.createElement('div');
        card.className = `flex items-center justify-between p-4 rounded-xl border bg-gradient-to-r ${coresGradiente[index]} mb-3`;
        
        card.innerHTML = `
          <div class="flex items-center gap-4">
            <div class="text-4xl">${medalhas[index]}</div>
            <div>
              <p class="text-base font-bold text-[#2c2c2c]">${funcionario.nome}</p>
              <p class="text-xs text-[#5a5a5a]">${funcionario.setor}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="text-2xl font-bold text-[#2c2c2c]">${funcionario.total}</p>
            <p class="text-xs text-[#5a5a5a]">RID${funcionario.total !== 1 ? 's' : ''}</p>
          </div>
        `;
        
        container.appendChild(card);
      });
      
    } catch (error) {
      console.error('Erro ao carregar ranking de emissões:', error);
      const container = document.getElementById('ranking-emissoes-container');
      container.innerHTML = '<div class="text-center py-8 text-red-600">Erro ao carregar ranking</div>';
    }
  }

  async function loadRidsTable() {
    try {
      const tbody = document.getElementById('rids-table-body');
      tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando RIDs...</td></tr>';
      
      const ridsRef = collection(db, 'rids');
      const ridsSnapshot = await getDocs(ridsRef);
      
      if (ridsSnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Nenhum RID cadastrado</td></tr>';
        return;
      }
      
      const pesquisa = document.getElementById('filtro-pesquisa-rids').value.trim().toUpperCase();
      const mesFiltro = document.getElementById('filtro-mes-rids').value;
      const anoFiltro = document.getElementById('filtro-ano-rids').value;
      
      let ridsFiltrados = [];
      
      ridsSnapshot.forEach((docSnap) => {
        const rid = docSnap.data();
        let incluir = true;
        
        if (pesquisa) {
          const numeroRid = (rid.numero || '').toUpperCase();
          const nomeEmitente = (rid.nome_emitente || '').toUpperCase();
          
          if (!numeroRid.includes(pesquisa) && !nomeEmitente.includes(pesquisa)) {
            incluir = false;
          }
        }
        
        if (incluir && (mesFiltro || anoFiltro)) {
          if (!rid.data) {
            incluir = false;
          } else {
            const dataRid = new Date(rid.data);
            const mesRid = String(dataRid.getMonth() + 1).padStart(2, '0');
            const anoRid = String(dataRid.getFullYear());
            
            if (mesFiltro && mesRid !== mesFiltro) {
              incluir = false;
            }
            
            if (anoFiltro && anoRid !== anoFiltro) {
              incluir = false;
            }
          }
        }
        
        if (incluir) {
          ridsFiltrados.push({ id: docSnap.id, ...rid });
        }
      });
      
      if (ridsFiltrados.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Nenhum RID encontrado com os filtros aplicados</td></tr>';
        return;
      }
      
      tbody.innerHTML = '';
      
      // Ordenar RIDs por número (ordem crescente de emissão)
      ridsFiltrados.sort((a, b) => {
        const numA = parseInt((a.numero || 'RID-0').replace('RID-', '')) || 0;
        const numB = parseInt((b.numero || 'RID-0').replace('RID-', '')) || 0;
        return numA - numB;
      });
      
      ridsFiltrados.forEach((ridData) => {
        const rid = ridData;
        
        let statusClass = 'bg-blue-100 text-blue-800 border-blue-300';
        const status = rid.status || 'Em Andamento';
        if (status === 'Corrigido') {
          statusClass = 'bg-green-100 text-green-800 border-green-300';
        } else if (status === 'Vencido') {
          statusClass = 'bg-red-100 text-red-800 border-red-300';
        }
        
        const dataFormatada = rid.data ? new Date(rid.data).toLocaleDateString('pt-BR') : 'N/A';
        
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#ece5df] transition-colors';
        
        tr.innerHTML = `
          <td class="px-4 py-3 text-sm text-[#2c2c2c] font-semibold cursor-pointer hover:text-[#ffd57a] transition-colors" data-rid-id="${ridData.id}">${rid.numero || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c] cursor-pointer" data-rid-id="${ridData.id}">${rid.nome_emitente || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c] cursor-pointer" data-rid-id="${ridData.id}">${rid.setor || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c] cursor-pointer" data-rid-id="${ridData.id}">${dataFormatada}</td>
          <td class="px-4 py-3 text-sm cursor-pointer" data-rid-id="${ridData.id}">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${statusClass}">
              ${status}
            </span>
          </td>
          <td class="px-4 py-3">
            <div class="flex items-center justify-center gap-2">
              <button class="btn-alerta-rid flex items-center justify-center hover:opacity-80 transition-opacity" title="Solicitar Exclus  o" data-rid-id="${ridData.id}">
                <svg width="24" height="24" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 4L36 34H4L20 4Z" fill="none" stroke="#dc2626" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M20 14V22" stroke="#dc2626" stroke-width="3" stroke-linecap="round"/>
                  <circle cx="20" cy="28" r="2" fill="#dc2626"/>
                </svg>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
    } catch (error) {
      console.error('Erro ao carregar RIDs:', error);
      const tbody = document.getElementById('rids-table-body');
      tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-red-600">Erro ao carregar RIDs</td></tr>';
    }
  }

  async function loadFuncionariosTable() {
    try {
      const tbody = document.getElementById('funcionarios-table-body');
      tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando funcionários...</td></tr>';
      
      const usersRef = collection(db, 'users');
      const usersSnapshot = await getDocs(usersRef);
      
      if (usersSnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-[#5a5a5a]">Nenhum funcionário cadastrado</td></tr>';
        return;
      }
      
      tbody.innerHTML = '';
      
      usersSnapshot.forEach((docSnap) => {
        const user = docSnap.data();
        
        const cpfFormatado = user.cpf ? formatCPF(user.cpf) : 'N/A';
        const cpfLimpo = (user.cpf || '').replace(/\D/g, '');
        
        const ehDesenvolvedor = LISTA_DESENVOLVEDORES.includes(cpfLimpo);
        const ehAdmin = LISTA_ADMINISTRATIVOS.includes(cpfLimpo);
        
        let tipoClass = 'bg-blue-100 text-blue-800 border-blue-300';
        let tipoTexto = 'Funcionário';
        
        if (ehDesenvolvedor) {
          tipoClass = 'bg-green-100 text-green-800 border-green-300';
          tipoTexto = 'Administrador';
        } else if (ehAdmin) {
          tipoClass = 'bg-purple-100 text-purple-800 border-purple-300';
          tipoTexto = 'Administrador';
        }
        
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#ece5df] transition-colors';
        
        tr.innerHTML = `
          <td class="px-4 py-3 text-sm text-[#2c2c2c] font-semibold">${user.nome || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${cpfFormatado}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${user.setor || 'N/A'}</td>
          <td class="px-4 py-3 text-sm">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${tipoClass}">
              ${tipoTexto}
            </span>
          </td>
          <td class="px-4 py-3">
            <div class="flex items-center justify-center gap-2">
              <button class="btn-alerta-func flex items-center justify-center hover:opacity-80 transition-opacity" title="Alerta" data-user-id="${docSnap.id}">
                <svg width="24" height="24" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 4L36 34H4L20 4Z" fill="none" stroke="#dc2626" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M20 14V22" stroke="#dc2626" stroke-width="3" stroke-linecap="round"/>
                  <circle cx="20" cy="28" r="2" fill="#dc2626"/>
                </svg>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
    } catch (error) {
      console.error('Erro ao carregar funcionários:', error);
      const tbody = document.getElementById('funcionarios-table-body');
      tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-600">Erro ao carregar funcionários</td></tr>';
    }
  }

  async function loadSolicitacoesTable() {
    try {
      const tbody = document.getElementById('solicitacoes-table-body');
      tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando solicita  ões...</td></tr>';
      
      const solicitacoesRef = collection(db, 'solicitacoes_exclusao');
      const solicitacoesSnapshot = await getDocs(solicitacoesRef);
      
      if (solicitacoesSnapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-[#5a5a5a]">Nenhuma solicitação de exclusão</td></tr>';
        return;
      }
      
      // Verificar se o usuário atual    desenvolvedor
      let ehDesenvolvedor = false;
      if (currentUser) {
        const usersRef = collection(db, 'users');
        const q = query(usersRef, where('uid', '==', currentUser.uid));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          const userData = querySnapshot.docs[0].data();
          const cpfLimpo = (userData.cpf || '').replace(/\D/g, '');
          ehDesenvolvedor = LISTA_DESENVOLVEDORES.includes(cpfLimpo);
        }
      }
      
      tbody.innerHTML = '';
      
      solicitacoesSnapshot.forEach((docSnap) => {
        const solicitacao = docSnap.data();
        
        let statusClass = 'bg-yellow-100 text-yellow-800 border-yellow-300';
        const status = solicitacao.status || 'Pendente';
        if (status === 'Aprovada') {
          statusClass = 'bg-green-100 text-green-800 border-green-300';
        } else if (status === 'Rejeitada') {
          statusClass = 'bg-red-100 text-red-800 border-red-300';
        }
        
        const dataFormatada = solicitacao.data_solicitacao ? 
          (solicitacao.data_solicitacao.toDate ? solicitacao.data_solicitacao.toDate() : new Date(solicitacao.data_solicitacao)).toLocaleDateString('pt-BR') : 
          'N/A';
        
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#ece5df] transition-colors';
        
        tr.innerHTML = `
          <td class="px-4 py-3 text-sm text-[#2c2c2c] font-semibold">${solicitacao.rid_numero || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${solicitacao.solicitante || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${solicitacao.motivo || 'N/A'}</td>
          <td class="px-4 py-3 text-sm text-[#2c2c2c]">${dataFormatada}</td>
          <td class="px-4 py-3 text-sm">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${statusClass}">
              ${status}
            </span>
          </td>
          <td class="px-4 py-3">
            <div class="flex items-center justify-center gap-2">
              ${status === 'Pendente' && ehDesenvolvedor ? `
                <button class="btn-aprovar-solicitacao w-8 h-8 flex items-center justify-center rounded-lg hover:bg-green-50 text-green-600 transition-colors" title="Aprovar" data-solicitacao-id="${docSnap.id}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </button>
                <button class="btn-rejeitar-solicitacao w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-50 text-red-600 transition-colors" title="Rejeitar" data-solicitacao-id="${docSnap.id}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </button>
              ` : status === 'Pendente' && !ehDesenvolvedor ? `
                <span class="text-xs text-[#5a5a5a] italic">Aguardando aprovação</span>
              ` : '<span class="text-xs text-[#5a5a5a]">Processada</span>'}
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
    } catch (error) {
      console.error('Erro ao carregar solicitações:', error);
      const tbody = document.getElementById('solicitacoes-table-body');
      tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-red-600">Erro ao carregar solicitações</td></tr>';
    }
  }

  async function loadRelatoriosTable() {
    try {
      const tbody = document.getElementById('relatorios-table-body');
      tbody.innerHTML = '<tr><td colspan="17" class="px-4 py-8 text-center text-[#5a5a5a]">Carregando relatórios...</td></tr>';
      
      const ridsRef = collection(db, 'rids');
      const ridsSnapshot = await getDocs(ridsRef);
      
      const mesFiltro = document.getElementById('filtro-mes-relatorios').value;
      const anoFiltro = document.getElementById('filtro-ano-relatorios').value;
      
      let ridsFiltrados = [];
      
      ridsSnapshot.forEach((doc) => {
        const rid = doc.data();
        ridsFiltrados.push({ id: doc.id, ...rid });
      });
      
      if (mesFiltro || anoFiltro) {
        ridsFiltrados = ridsFiltrados.filter(rid => {
          if (!rid.data) return false;
          
          const dataRid = new Date(rid.data);
          const mesRid = String(dataRid.getMonth() + 1).padStart(2, '0');
          const anoRid = String(dataRid.getFullYear());
          
          let passaMes = true;
          let passaAno = true;
          
          if (mesFiltro) {
            passaMes = mesRid === mesFiltro;
          }
          
          if (anoFiltro) {
            passaAno = anoRid === anoFiltro;
          }
          
          return passaMes && passaAno;
        });
      }
      
      if (ridsFiltrados.length === 0) {
        tbody.innerHTML = '<tr><td colspan="17" class="px-4 py-8 text-center text-[#5a5a5a]">Nenhum RID encontrado para o período selecionado</td></tr>';
        return;
      }
      
      // Ordenar RIDs por número (ordem crescente de emissão)
      ridsFiltrados.sort((a, b) => {
        const numA = parseInt((a.numero || 'RID-0').replace('RID-', '')) || 0;
        const numB = parseInt((b.numero || 'RID-0').replace('RID-', '')) || 0;
        return numA - numB;
      });
      
      tbody.innerHTML = '';
      
      ridsFiltrados.forEach((rid) => {
        const dataEmissao = rid.data ? new Date(rid.data).toLocaleDateString('pt-BR') : 'N/A';
        const dataConclusao = rid.data_conclusao ? new Date(rid.data_conclusao).toLocaleDateString('pt-BR') : 'N/A';
        const prazoConclusao = rid.prazo_conclusao ? new Date(rid.prazo_conclusao).toLocaleDateString('pt-BR') : 'N/A';
        
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#ece5df] transition-colors';
        tr.dataset.ridId = rid.id;
        
        tr.innerHTML = `
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="unidade">${rid.unidade || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] font-semibold whitespace-nowrap">${rid.numero || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="data">${dataEmissao}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="nome_emitente">${rid.nome_emitente || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="tipo_contrato">${rid.tipo_contrato || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="setor">${rid.setor || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="local_ocorrencia">${rid.local_ocorrencia || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="incidente">${rid.incidente || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="origem_deteccao">${rid.origem_deteccao || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="descricao" style="max-width: 200px; white-space: normal;">${rid.descricao || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="classificacao_risco">${rid.classificacao_risco || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="acao_imediata" style="max-width: 200px; white-space: normal;">${rid.acao_imediata || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="acoes_corretivas" style="max-width: 200px; white-space: normal;">${rid.acoes_corretivas || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="responsavel_acoes">${rid.responsavel_acoes || 'N/A'}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="prazo_conclusao">${prazoConclusao}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="data_conclusao">${dataConclusao}</td>
          <td class="px-3 py-3 text-xs text-[#2c2c2c] whitespace-nowrap editable-cell cursor-text hover:bg-blue-50" contenteditable="true" data-field="status">${rid.status || 'Em Andamento'}</td>
        `;
        
        tbody.appendChild(tr);
      });
      
    } catch (error) {
      console.error('Erro ao carregar relatórios:', error);
      const tbody = document.getElementById('relatorios-table-body');
      tbody.innerHTML = '<tr><td colspan="17" class="px-4 py-8 text-center text-red-600">Erro ao carregar relatórios</td></tr>';
    }
  }

  document.getElementById('filtro-mes-visao').addEventListener('change', loadDashboardData);
  document.getElementById('filtro-ano-visao').addEventListener('input', loadDashboardData);
  document.getElementById('filtro-mes-ranking').addEventListener('change', loadRankingEmissoes);
  document.getElementById('filtro-ano-ranking').addEventListener('input', loadRankingEmissoes);

  document.getElementById('btn-aplicar-filtros-rids').addEventListener('click', () => {
    loadRidsTable();
    document.getElementById('dropdown-filtro-rids').classList.add('hidden');
  });

  document.getElementById('btn-limpar-filtros-rids').addEventListener('click', () => {
    document.getElementById('filtro-pesquisa-rids').value = '';
    document.getElementById('filtro-mes-rids').value = '';
    document.getElementById('filtro-ano-rids').value = '';
    loadRidsTable();
  });

  document.getElementById('filtro-pesquisa-rids').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      loadRidsTable();
      document.getElementById('dropdown-filtro-rids').classList.add('hidden');
    }
  });

  let itemExclusaoAtual = null;
  let tipoExclusaoAtual = null;
  let ridAtualId = null;

  document.getElementById('btn-fechar-modal-detalhes').addEventListener('click', () => {
    document.getElementById('modal-detalhes-rid').classList.add('hidden');
    document.getElementById('form-editar-rid').reset();
    ridAtualId = null;
  });

  document.getElementById('btn-cancelar-detalhes').addEventListener('click', () => {
    document.getElementById('modal-detalhes-rid').classList.add('hidden');
    document.getElementById('form-editar-rid').reset();
    ridAtualId = null;
  });

  let ridDesignarAtual = null;

  document.getElementById('btn-fechar-modal-designar').addEventListener('click', () => {
    document.getElementById('modal-designar-lider').classList.add('hidden');
    document.getElementById('form-designar-lider').reset();
    ridDesignarAtual = null;
  });

  document.getElementById('btn-cancelar-designar').addEventListener('click', () => {
    document.getElementById('modal-designar-lider').classList.add('hidden');
    document.getElementById('form-designar-lider').reset();
    ridDesignarAtual = null;
  });

  async function abrirModalDesignar(ridId, ridNumero) {
    ridDesignarAtual = ridId;
    
    document.getElementById('designar-rid-numero').value = ridNumero;
    
    const selectLider = document.getElementById('designar-lider-select');
    selectLider.innerHTML = '<option value="">Carregando administradores...</option>';
    
    try {
      const usersRef = collection(db, 'users');
      const usersSnapshot = await getDocs(usersRef);
      
      selectLider.innerHTML = '<option value="">Selecione um administrador</option>';
      
      usersSnapshot.forEach((docSnap) => {
        const user = docSnap.data();
        const cpfLimpo = (user.cpf || '').replace(/\D/g, '');
        const ehAdmin = LISTA_ADMINISTRATIVOS.includes(cpfLimpo);
        const ehDesenvolvedor = LISTA_DESENVOLVEDORES.includes(cpfLimpo);
        
        if (ehAdmin || ehDesenvolvedor) {
          const option = document.createElement('option');
          option.value = user.nome || '';
          option.textContent = user.nome || 'Sem nome';
          selectLider.appendChild(option);
        }
      });
      
      document.getElementById('modal-designar-lider').classList.remove('hidden');
      
    } catch (error) {
      console.error('Erro ao carregar administradores:', error);
      selectLider.innerHTML = '<option value="">Erro ao carregar administradores</option>';
    }
  }

  document.getElementById('form-designar-lider').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!ridDesignarAtual) {
      showMessage('designar-message', 'Erro: RID não identificado', 'error');
      return;
    }
    
    const liderSelecionado = document.getElementById('designar-lider-select').value;
    const prazo = document.getElementById('designar-prazo').value;
    const observacao = document.getElementById('designar-observacao').value.trim();
    const btn = document.getElementById('btn-confirmar-designar');
    
    btn.disabled = true;
    btn.textContent = 'Designando...';
    
    try {
      const ridRef = doc(db, 'rids', ridDesignarAtual);
      
      const dadosAtualizacao = {
        lider_designado: liderSelecionado,
        prazo_conclusao: prazo
      };
      
      if (observacao) {
        dadosAtualizacao.observacao_lider = observacao;
      }
      
      await updateDoc(ridRef, dadosAtualizacao);
      
      // Buscar dados do RID para a notificação
      const ridsSnapshot = await getDocs(collection(db, 'rids'));
      let ridNumero = '';
      ridsSnapshot.forEach((docSnap) => {
        if (docSnap.id === ridDesignarAtual) {
          ridNumero = docSnap.data().numero || 'N/A';
        }
      });
      
      // Buscar nome do administrador que está designando
      const usersRef = collection(db, 'users');
      const qAdmin = query(usersRef, where('uid', '==', currentUser.uid));
      const adminSnapshot = await getDocs(qAdmin);
      let nomeAdmin = 'Administrador';
      if (!adminSnapshot.empty) {
        nomeAdmin = adminSnapshot.docs[0].data().nome || 'Administrador';
      }
      
      // Criar notificação para o líder designado
      const notificacoesRef = collection(db, 'notificacoes');
      await addDoc(notificacoesRef, {
        destinatario: liderSelecionado,
        tipo: 'designacao_rid',
        titulo: 'Novo RID Designado',
        mensagem: `${nomeAdmin} designou o ${ridNumero} para você. Prazo: ${new Date(prazo).toLocaleDateString('pt-BR')}`,
        rid_numero: ridNumero,
        rid_id: ridDesignarAtual,
        lida: false,
        data_criacao: serverTimestamp()
      });
      
      showMessage('designar-message', `Líder "${liderSelecionado}" designado com sucesso!`, 'success');
      
      setTimeout(() => {
        document.getElementById('modal-designar-lider').classList.add('hidden');
        document.getElementById('form-designar-lider').reset();
        ridDesignarAtual = null;
        
        loadRidsTable();
        loadDashboardData();
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao designar líder:', error);
      showMessage('designar-message', 'Erro ao designar líder. Tente novamente.', 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Designar Líder';
    }
  });

  document.getElementById('form-editar-rid').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!ridAtualId) {
      showMessage('detalhes-message', 'Erro: RID não identificado', 'error');
      return;
    }
    
    const btn = document.getElementById('btn-salvar-detalhes');
    btn.disabled = true;
    btn.textContent = 'Salvando...';
    
    try {
      const ridRef = doc(db, 'rids', ridAtualId);
      
      const dadosAtualizados = {
        nome_emitente: document.getElementById('detalhes-emitente').value,
        tipo_contrato: document.getElementById('detalhes-tipo-contrato').value,
        unidade: document.getElementById('detalhes-unidade').value.toUpperCase(),
        setor: document.getElementById('detalhes-setor').value,
        data: document.getElementById('detalhes-data').value,
        incidente: document.getElementById('detalhes-incidente').value,
        origem_deteccao: document.getElementById('detalhes-origem').value,
        local_ocorrencia: document.getElementById('detalhes-local').value,
        descricao: document.getElementById('detalhes-descricao').value,
        acao_imediata: document.getElementById('detalhes-acao-imediata').value,
        classificacao_risco: document.getElementById('detalhes-classificacao').value,
        status: document.getElementById('detalhes-status').value,
        lider_designado: document.getElementById('detalhes-lider').value || null
      };
      
      await updateDoc(ridRef, dadosAtualizados);
      
      showMessage('detalhes-message', 'RID atualizado com sucesso!', 'success');
      
      setTimeout(() => {
        document.getElementById('modal-detalhes-rid').classList.add('hidden');
        document.getElementById('form-editar-rid').reset();
        ridAtualId = null;
        
        loadRidsTable();
        loadDashboardData();
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao atualizar RID:', error);
      showMessage('detalhes-message', 'Erro ao atualizar RID. Tente novamente.', 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Salvar Alterações';
    }
  });

  document.addEventListener('click', async (e) => {
    const tdElement = e.target.closest('td[data-rid-id]');
    
    if (tdElement && !e.target.closest('.btn-alerta-rid')) {
      const ridId = tdElement.dataset.ridId;
      
      try {
        const ridRef = doc(db, 'rids', ridId);
        const ridDoc = await getDocs(collection(db, 'rids'));
        
        let ridData = null;
        ridDoc.forEach((docSnap) => {
          if (docSnap.id === ridId) {
            ridData = docSnap.data();
          }
        });
        
        if (ridData) {
          ridAtualId = ridId;
          
          document.getElementById('detalhes-numero').value = ridData.numero || '';
          document.getElementById('detalhes-emitente').value = ridData.nome_emitente || '';
          document.getElementById('detalhes-tipo-contrato').value = ridData.tipo_contrato || '';
          document.getElementById('detalhes-unidade').value = ridData.unidade || '';
          document.getElementById('detalhes-setor').value = ridData.setor || '';
          document.getElementById('detalhes-data').value = ridData.data || '';
          document.getElementById('detalhes-incidente').value = ridData.incidente || '';
          document.getElementById('detalhes-origem').value = ridData.origem_deteccao || '';
          document.getElementById('detalhes-local').value = ridData.local_ocorrencia || '';
          document.getElementById('detalhes-descricao').value = ridData.descricao || '';
          document.getElementById('detalhes-acao-imediata').value = ridData.acao_imediata || '';
          document.getElementById('detalhes-classificacao').value = ridData.classificacao_risco || '';
          document.getElementById('detalhes-status').value = ridData.status || '';
          
          const selectLider = document.getElementById('detalhes-lider');
          selectLider.innerHTML = '<option value="">Selecione um líder</option>';
          
          const usersRef = collection(db, 'users');
          const usersSnapshot = await getDocs(usersRef);
          
          usersSnapshot.forEach((docSnap) => {
            const user = docSnap.data();
            const cpfLimpo = (user.cpf || '').replace(/\D/g, '');
            const ehAdmin = LISTA_ADMINISTRATIVOS.includes(cpfLimpo);
            
            if (ehAdmin) {
              const option = document.createElement('option');
              option.value = user.nome || '';
              option.textContent = user.nome || 'Sem nome';
              selectLider.appendChild(option);
            }
          });
          
          selectLider.value = ridData.lider_designado || '';
          
          document.getElementById('modal-detalhes-rid').classList.remove('hidden');
        }
        
      } catch (error) {
        console.error('Erro ao carregar detalhes do RID:', error);
      }
    }
  });

  document.getElementById('btn-abrir-designacao').addEventListener('click', () => {
    if (ridAtualId) {
      const ridNumero = document.getElementById('detalhes-numero').value;
      abrirModalDesignar(ridAtualId, ridNumero);
    }
  });

  document.addEventListener('click', (e) => {
    if (e.target.closest('.btn-alerta-rid')) {
      const btn = e.target.closest('.btn-alerta-rid');
      const ridId = btn.dataset.ridId;
      
      const ridsRef = collection(db, 'rids');
      getDocs(ridsRef).then(snapshot => {
        snapshot.forEach(doc => {
          if (doc.id === ridId) {
            const rid = doc.data();
            itemExclusaoAtual = { id: ridId, ...rid };
            tipoExclusaoAtual = 'rid';
            
            document.getElementById('exclusao-item').value = `RID: ${rid.numero || 'N/A'}`;
            document.getElementById('modal-solicitar-exclusao').classList.remove('hidden');
          }
        });
      });
    }
    
    if (e.target.closest('.btn-alerta-func')) {
      const btn = e.target.closest('.btn-alerta-func');
      const userId = btn.dataset.userId;
      
      const usersRef = collection(db, 'users');
      getDocs(usersRef).then(snapshot => {
        snapshot.forEach(doc => {
          if (doc.id === userId) {
            const user = doc.data();
            itemExclusaoAtual = { id: userId, ...user };
            tipoExclusaoAtual = 'funcionario';
            
            document.getElementById('exclusao-item').value = `Funcionário: ${user.nome || 'N/A'} (CPF: ${formatCPF(user.cpf || '')})`;
            document.getElementById('modal-solicitar-exclusao').classList.remove('hidden');
          }
        });
      });
    }
    
    if (e.target.closest('.btn-alerta-solicitacao')) {
      const btn = e.target.closest('.btn-alerta-solicitacao');
      const solicitacaoId = btn.dataset.solicitacaoId;
      
      const solicitacoesRef = collection(db, 'solicitacoes_exclusao');
      getDocs(solicitacoesRef).then(snapshot => {
        snapshot.forEach(doc => {
          if (doc.id === solicitacaoId) {
            const solicitacao = doc.data();
            itemExclusaoAtual = { id: solicitacaoId, ...solicitacao };
            tipoExclusaoAtual = 'solicitacao';
            
            document.getElementById('exclusao-item').value = `Solicitação: ${solicitacao.rid_numero || 'N/A'} - ${solicitacao.solicitante || 'N/A'}`;
            document.getElementById('modal-solicitar-exclusao').classList.remove('hidden');
          }
        });
      });
    }
  });

  document.getElementById('btn-fechar-modal-exclusao').addEventListener('click', () => {
    document.getElementById('modal-solicitar-exclusao').classList.add('hidden');
    document.getElementById('form-solicitar-exclusao').reset();
    itemExclusaoAtual = null;
    tipoExclusaoAtual = null;
  });

  document.getElementById('btn-cancelar-exclusao').addEventListener('click', () => {
    document.getElementById('modal-solicitar-exclusao').classList.add('hidden');
    document.getElementById('form-solicitar-exclusao').reset();
    itemExclusaoAtual = null;
    tipoExclusaoAtual = null;
  });

  document.getElementById('form-solicitar-exclusao').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!itemExclusaoAtual || !tipoExclusaoAtual) {
      showMessage('exclusao-message', 'Erro: item não identificado', 'error');
      return;
    }
    
    const motivo = document.getElementById('exclusao-motivo').value.trim();
    const btn = document.getElementById('btn-confirmar-exclusao');
    
    btn.disabled = true;
    btn.textContent = 'Enviando...';
    
    try {
      const usersRef = collection(db, 'users');
      const q = query(usersRef, where('uid', '==', currentUser.uid));
      const querySnapshot = await getDocs(q);
      
      let nomeSolicitante = 'Desconhecido';
      if (!querySnapshot.empty) {
        nomeSolicitante = querySnapshot.docs[0].data().nome || 'Desconhecido';
      }
      
      const solicitacoesRef = collection(db, 'solicitacoes_exclusao');
      
      const solicitacaoData = {
        tipo: tipoExclusaoAtual,
        item_id: itemExclusaoAtual.id,
        solicitante: nomeSolicitante,
        motivo: motivo,
        status: 'Pendente',
        data_solicitacao: serverTimestamp()
      };
      
      if (tipoExclusaoAtual === 'rid') {
        solicitacaoData.rid_numero = itemExclusaoAtual.numero || 'N/A';
        solicitacaoData.rid_emitente = itemExclusaoAtual.nome_emitente || 'N/A';
      } else if (tipoExclusaoAtual === 'funcionario') {
        solicitacaoData.funcionario_nome = itemExclusaoAtual.nome || 'N/A';
        solicitacaoData.funcionario_cpf = itemExclusaoAtual.cpf || 'N/A';
      } else if (tipoExclusaoAtual === 'solicitacao') {
        solicitacaoData.solicitacao_original_id = itemExclusaoAtual.id;
        solicitacaoData.rid_numero = itemExclusaoAtual.rid_numero || 'N/A';
        solicitacaoData.solicitante_original = itemExclusaoAtual.solicitante || 'N/A';
      }
      
      await addDoc(solicitacoesRef, solicitacaoData);
      
      showMessage('exclusao-message', 'Solicitação enviada com sucesso!', 'success');
      
      setTimeout(() => {
        document.getElementById('modal-solicitar-exclusao').classList.add('hidden');
        document.getElementById('form-solicitar-exclusao').reset();
        itemExclusaoAtual = null;
        tipoExclusaoAtual = null;
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao enviar solicitação:', error);
      showMessage('exclusao-message', 'Erro ao enviar solicitação. Tente novamente.', 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Enviar Solicitação';
    }
  });

  document.addEventListener('blur', async (e) => {
    if (e.target.classList.contains('editable-cell')) {
      const cell = e.target;
      const row = cell.closest('tr');
      const ridId = row.dataset.ridId;
      const field = cell.dataset.field;
      const newValue = cell.textContent.trim();
      
      if (!ridId || !field) return;
      
      try {
        const ridRef = doc(db, 'rids', ridId);
        
        let valorParaSalvar = newValue;
        
        if (field === 'data' || field === 'prazo_conclusao' || field === 'data_conclusao') {
          const partesData = newValue.split('/');
          if (partesData.length === 3) {
            valorParaSalvar = `${partesData[2]}-${partesData[1]}-${partesData[0]}`;
          }
        }
        
        const dadosAtualizacao = {};
        dadosAtualizacao[field] = valorParaSalvar;
        
        await updateDoc(ridRef, dadosAtualizacao);
        
        cell.style.backgroundColor = '#d1fae5';
        setTimeout(() => {
          cell.style.backgroundColor = '';
        }, 1000);
        
      } catch (error) {
        console.error('Erro ao salvar alteração:', error);
        
        cell.style.backgroundColor = '#fee2e2';
        setTimeout(() => {
          cell.style.backgroundColor = '';
        }, 2000);
      }
    }
  }, true);

  async function loadNotificacoes(nomeUsuario, isAdmin) {
    try {
      const notificacoesRef = collection(db, 'notificacoes');
      const q = query(notificacoesRef, where('destinatario', '==', nomeUsuario), where('lida', '==', false));
      const notificacoesSnapshot = await getDocs(q);
      
      const listaAdmin = document.getElementById('lista-notificacoes-admin');
      const listaFunc = document.getElementById('lista-notificacoes-func');
      const badgeAdmin = document.getElementById('badge-notif-admin');
      const badgeFunc = document.getElementById('badge-notif-func');
      
      const lista = isAdmin ? listaAdmin : listaFunc;
      const badge = isAdmin ? badgeAdmin : badgeFunc;
      
      if (notificacoesSnapshot.empty) {
        lista.innerHTML = '<div class="px-4 py-8 text-center text-sm text-[#5a5a5a]">Nenhuma notificação</div>';
        badge.classList.add('hidden');
        return;
      }
      
      badge.classList.remove('hidden');
      lista.innerHTML = '';
      
      notificacoesSnapshot.forEach((docSnap) => {
        const notif = docSnap.data();
        const dataFormatada = notif.data_criacao ? 
          (notif.data_criacao.toDate ? notif.data_criacao.toDate() : new Date(notif.data_criacao)).toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          }) : 'Agora';
        
        const notifElement = document.createElement('div');
        notifElement.className = 'px-4 py-3 border-b border-[#b0b0b0] hover:bg-[#ece5df] transition-colors cursor-pointer';
        notifElement.dataset.notifId = docSnap.id;
        notifElement.dataset.ridId = notif.rid_id || '';
        
        notifElement.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="w-2 h-2 bg-blue-500 rounded-full mt-1.5 flex-shrink-0"></div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-semibold text-[#2c2c2c] mb-1">${notif.titulo || 'Notificação'}</p>
              <p class="text-xs text-[#5a5a5a] mb-2">${notif.mensagem || ''}</p>
              <p class="text-xs text-[#5a5a5a]">${dataFormatada}</p>
            </div>
          </div>
        `;
        
        notifElement.addEventListener('click', async () => {
          try {
            const notifRef = doc(db, 'notificacoes', docSnap.id);
            await updateDoc(notifRef, { lida: true });
            
            if (notif.rid_id) {
              const ridRef = doc(db, 'rids', notif.rid_id);
              const ridDoc = await getDocs(collection(db, 'rids'));
              
              let ridData = null;
              ridDoc.forEach((ridDocSnap) => {
                if (ridDocSnap.id === notif.rid_id) {
                  ridData = ridDocSnap.data();
                }
              });
              
              if (ridData) {
                ridAtualId = notif.rid_id;
                
                document.getElementById('detalhes-numero').value = ridData.numero || '';
                document.getElementById('detalhes-emitente').value = ridData.nome_emitente || '';
                document.getElementById('detalhes-tipo-contrato').value = ridData.tipo_contrato || '';
                document.getElementById('detalhes-unidade').value = ridData.unidade || '';
                document.getElementById('detalhes-setor').value = ridData.setor || '';
                document.getElementById('detalhes-data').value = ridData.data || '';
                document.getElementById('detalhes-incidente').value = ridData.incidente || '';
                document.getElementById('detalhes-origem').value = ridData.origem_deteccao || '';
                document.getElementById('detalhes-local').value = ridData.local_ocorrencia || '';
                document.getElementById('detalhes-descricao').value = ridData.descricao || '';
                document.getElementById('detalhes-acao-imediata').value = ridData.acao_imediata || '';
                document.getElementById('detalhes-classificacao').value = ridData.classificacao_risco || '';
                document.getElementById('detalhes-status').value = ridData.status || '';
                
                const selectLider = document.getElementById('detalhes-lider');
                selectLider.innerHTML = '<option value="">Selecione um líder</option>';
                
                const usersRef = collection(db, 'users');
                const usersSnapshot = await getDocs(usersRef);
                
                usersSnapshot.forEach((userDocSnap) => {
                  const user = userDocSnap.data();
                  const cpfLimpo = (user.cpf || '').replace(/\D/g, '');
                  const ehAdmin = LISTA_ADMINISTRATIVOS.includes(cpfLimpo);
                  
                  if (ehAdmin) {
                    const option = document.createElement('option');
                    option.value = user.nome || '';
                    option.textContent = user.nome || 'Sem nome';
                    selectLider.appendChild(option);
                  }
                });
                
                selectLider.value = ridData.lider_designado || '';
                
                document.getElementById('modal-detalhes-rid').classList.remove('hidden');
                
                if (isAdmin) {
                  document.getElementById('dropdown-notificacoes-admin').classList.add('hidden');
                } else {
                  document.getElementById('dropdown-notificacoes-func').classList.add('hidden');
                }
              }
            }
            
            loadNotificacoes(nomeUsuario, isAdmin);
            
          } catch (error) {
            console.error('Erro ao marcar notificação como lida:', error);
          }
        });
        
        lista.appendChild(notifElement);
      });
      
    } catch (error) {
      console.error('Erro ao carregar notificações:', error);
    }
  }

  onAuthStateChanged(auth, async (user) => {
    if (isCreatingUser) {
      return;
    }
    
    if (user) {
      currentUser = user;
      
      try {
        const usersRef = collection(db, 'users');
        const q = query(usersRef, where('uid', '==', user.uid));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          const userData = querySnapshot.docs[0].data();
          const cpfUsuario = userData.cpf || '';
          const nomeUsuario = userData.nome || '';
          
          const ehAdmin = await isAdmin(cpfUsuario);
          
          if (ehAdmin) {
            showView('admin');
            loadDashboardData();
            loadNotificacoes(nomeUsuario, true);
            
            setInterval(() => {
              loadNotificacoes(nomeUsuario, true);
            }, 30000);
          } else {
            showView('func');
            loadFuncRids(userData.nome);
            loadNotificacoes(nomeUsuario, false);
            
            setInterval(() => {
              loadNotificacoes(nomeUsuario, false);
            }, 30000);
          }
        }
      } catch (error) {
        console.error('Erro ao verificar usuário:', error);
        showView('login');
        
        // Resetar o botão de login em caso de erro
        const btnEntrar = document.getElementById('btn-entrar');
        if (btnEntrar) {
          btnEntrar.disabled = false;
          btnEntrar.textContent = 'Entrar';
        }
      }
    } else {
      currentUser = null;
      showView('login');
      
      // Resetar o botão de login quando não há usuário
      const btnEntrar = document.getElementById('btn-entrar');
      if (btnEntrar) {
        btnEntrar.disabled = false;
        btnEntrar.textContent = 'Entrar';
      }
    }
  });
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ab51b748655c6c1',t:'MTc2NTI4OTY0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>